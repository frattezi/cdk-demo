"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cxschema = require("@aws-cdk/cloud-assembly-schema");
const cxapi = require("@aws-cdk/cx-api");
const fs_1 = require("fs");
const path_1 = require("path");
const index_1 = require("../lib/index");
test('support resource with no properties', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
            },
        },
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource'))).not.toThrowError();
});
test('haveResource tells you about mismatched fields', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: 'somevalue',
                },
            },
        },
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: 'othervalue',
        }));
    }).toThrowError(/PropA/);
});
test('haveResource value matching is strict by default', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'This is unexpected, so the value of PropA doesn\'t strictly match - it shouldn\'t pass',
                    },
                    PropB: 'This property is unexpected, but it\'s allowed',
                },
            },
        },
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: {
                foo: 'somevalue',
            },
        }));
    }).toThrowError(/PropA/);
});
test('haveResource allows to opt in value extension', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'Additional value is permitted, as we opted in',
                    },
                    PropB: 'Additional properties is always okay!',
                },
            },
        },
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
        PropA: {
            foo: 'somevalue',
        },
    }, undefined, true))).not.toThrowError();
});
describe('property absence', () => {
    test('pass on absence', () => {
        const synthStack = mkSomeResource({
            Prop: 'somevalue',
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: index_1.ABSENT,
        }));
    });
    test('fail on presence', () => {
        const synthStack = mkSomeResource({
            PropA: 3,
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                PropA: index_1.ABSENT,
            }));
        }).toThrowError(/PropA/);
    });
    test('pass on deep absence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            },
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            Deep: {
                Prop: 'somevalue',
                PropA: index_1.ABSENT,
            },
        }));
    });
    test('fail on deep presence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            },
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                Deep: {
                    Prop: index_1.ABSENT,
                },
            }));
        }).toThrowError(/Prop/);
    });
});
function mkStack(template) {
    const assembly = new cxapi.CloudAssemblyBuilder();
    assembly.addArtifact('test', {
        type: cxschema.ArtifactType.AWS_CLOUDFORMATION_STACK,
        environment: cxapi.EnvironmentUtils.format('123456789', 'us-west-2'),
        properties: {
            templateFile: 'template.json',
        },
    });
    fs_1.writeFileSync(path_1.join(assembly.outdir, 'template.json'), JSON.stringify(template));
    return assembly.buildAssembly().getStackByName('test');
}
function mkSomeResource(props) {
    return mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: props,
            },
        },
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGF2ZS1yZXNvdXJjZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaGF2ZS1yZXNvdXJjZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkRBQTJEO0FBQzNELHlDQUF5QztBQUN6QywyQkFBbUM7QUFDbkMsK0JBQTRCO0FBQzVCLHdDQUF5RTtBQUV6RSxJQUFJLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUN6QixTQUFTLEVBQUU7WUFDVCxZQUFZLEVBQUU7Z0JBQ1osSUFBSSxFQUFFLGdCQUFnQjthQUN2QjtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLGNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsb0JBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDNUYsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO0lBQzFELE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUN6QixTQUFTLEVBQUU7WUFDVCxZQUFZLEVBQUU7Z0JBQ1osSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsVUFBVSxFQUFFO29CQUNWLEtBQUssRUFBRSxXQUFXO2lCQUNuQjthQUNGO1NBQ0Y7S0FDRixDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ1YsY0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxvQkFBWSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RELEtBQUssRUFBRSxZQUFZO1NBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGtEQUFrRCxFQUFFLEdB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RUFBRSxnQkFBZ0I7Z0JBQ3RCLFVBQVUsRUFBRSxLQUFLO2FBQ2xCO1NBQ0Y7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY3hzY2hlbWEgZnJvbSAnQGF3cy1jZGsvY2xvdWQtYXNzZW1ibHktc2NoZW1hJztcbmltcG9ydCAqIGFzIGN4YXBpIGZyb20gJ0Bhd3MtY2RrL2N4LWFwaSc7XG5pbXBvcnQgeyB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgQUJTRU5ULCBleHBlY3QgYXMgY2RrRXhwZWN0LCBoYXZlUmVzb3VyY2UgfSBmcm9tICcuLi9saWIvaW5kZXgnO1xuXG50ZXN0KCdzdXBwb3J0IHJlc291cmNlIHdpdGggbm8gcHJvcGVydGllcycsICgpID0+IHtcbiAgY29uc3Qgc3ludGhTdGFjayA9IG1rU3RhY2soe1xuICAgIFJlc291cmNlczoge1xuICAgICAgU29tZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICBleHBlY3QoKCkgPT4gY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnKSkpLm5vdC50b1Rocm93RXJyb3IoKTtcbn0pO1xuXG50ZXN0KCdoYXZlUmVzb3VyY2UgdGVsbHMgeW91IGFib3V0IG1pc21hdGNoZWQgZmllbGRzJywgKCkgPT4ge1xuICBjb25zdCBzeW50aFN0YWNrID0gbWtTdGFjayh7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBTb21lUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIFByb3BBOiAnc29tZXZhbHVlJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiAnb3RoZXJ2YWx1ZScsXG4gICAgfSkpO1xuICB9KS50b1Rocm93RXJyb3IoL1Byb3BBLyk7XG59KTtcblxudGVzdCgnaGF2ZVJlc291cmNlIHZhbHVlIG1hdGNoaW5nIGlzIHN0cmljdCBieSBkZWZhdWx0JywgKCkgPT4ge1xuICBjb25zdCBzeW50aFN0YWNrID0gbWtTdGFjayh7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBTb21lUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIFByb3BBOiB7XG4gICAgICAgICAgICBmb286ICdzb21ldmFsdWUnLFxuICAgICAgICAgICAgYmFyOiAnVGhpcyBpcyB1bmV4cGVjdGVkLCBzbyB0aGUgdmFsdWUgb2YgUHJvcEEgZG9lc25cXCd0IHN0cmljdGx5IG1hdGNoIC0gaXQgc2hvdWxkblxcJ3QgcGFzcycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBQcm9wQjogJ1RoaXMgcHJvcGVydHkgaXMgdW5leHBlY3RlZCwgYnV0IGl0XFwncyBhbGxvd2VkJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiB7XG4gICAgICAgIGZvbzogJ3NvbWV2YWx1ZScsXG4gICAgICB9LFxuICAgIH0pKTtcbiAgfSkudG9UaHJvd0Vycm9yKC9Qcm9wQS8pO1xufSk7XG5cbnRlc3QoJ2hhdmVSZXNvdXJjZSBhbGxvd3MgdG8gb3B0IGluIHZhbHVlIGV4dGVuc2lvbicsICgpID0+IHtcbiAgY29uc3Qgc3ludGhTdGFjayA9IG1rU3RhY2soe1xuICAgIFJlc291cmNlczoge1xuICAgICAgU29tZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICBQcm9wQToge1xuICAgICAgICAgICAgZm9vOiAnc29tZXZhbHVlJyxcbiAgICAgICAgICAgIGJhcjogJ0FkZGl0aW9uYWwgdmFsdWUgaXMgcGVybWl0dGVkLCBhcyB3ZSBvcHRlZCBpbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBQcm9wQjogJ0FkZGl0aW9uYWwgcHJvcGVydGllcyBpcyBhbHdheXMgb2theSEnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBleHBlY3QoKCkgPT5cbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiB7XG4gICAgICAgIGZvbzogJ3NvbWV2YWx1ZScsXG4gICAgICB9LFxuICAgIH0sIHVuZGVmaW5lZCwgdHJ1ZSkpLFxuICApLm5vdC50b1Rocm93RXJyb3IoKTtcbn0pO1xuXG5kZXNjcmliZSgncHJvcGVydHkgYWJzZW5jZScsICgpID0+IHtcbiAgdGVzdCgncGFzcyBvbiBhYnNlbmNlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN5bnRoU3RhY2sgPSBta1NvbWVSZXNvdXJjZSh7XG4gICAgICBQcm9wOiAnc29tZXZhbHVlJyxcbiAgICB9KTtcblxuICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgUHJvcEE6IEFCU0VOVCxcbiAgICB9KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZhaWwgb24gcHJlc2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIFByb3BBOiAzLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgICBQcm9wQTogQUJTRU5ULFxuICAgICAgfSkpO1xuICAgIH0pLnRvVGhyb3dFcnJvcigvUHJvcEEvKTtcbiAgfSk7XG5cbiAgdGVzdCgncGFzcyBvbiBkZWVwIGFic2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIERlZXA6IHtcbiAgICAgICAgUHJvcDogJ3NvbWV2YWx1ZScsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICBEZWVwOiB7XG4gICAgICAgIFByb3A6ICdzb21ldmFsdWUnLFxuICAgICAgICBQcm9wQTogQUJTRU5ULFxuICAgICAgfSxcbiAgICB9KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZhaWwgb24gZGVlcCBwcmVzZW5jZScsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgRGVlcDoge1xuICAgICAgICBQcm9wOiAnc29tZXZhbHVlJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIERlZXA6IHtcbiAgICAgICAgICBQcm9wOiBBQlNFTlQsXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9Qcm9wLyk7XG4gIH0pO1xuXG59KTtcblxuZnVuY3Rpb24gbWtTdGFjayh0ZW1wbGF0ZTogYW55KTogY3hhcGkuQ2xvdWRGb3JtYXRpb25TdGFja0FydGlmYWN0IHtcbiAgY29uc3QgYXNzZW1ibHkgPSBuZXcgY3hhcGkuQ2xvdWRBc3NlbWJseUJ1aWxkZXIoKTtcbiAgYXNzZW1ibHkuYWRkQXJ0aWZhY3QoJ3Rlc3QnLCB7XG4gICAgdHlwZTogY3hzY2hlbWEuQXJ0aWZhY3RUeXBlLkFXU19DTE9VREZPUk1BVElPTl9TVEFDSyxcbiAgICBlbnZpcm9ubWVudDogY3hhcGkuRW52aXJvbm1lbnRVdGlscy5mb3JtYXQoJzEyMzQ1Njc4OScsICd1cy13ZXN0LTInKSxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICB0ZW1wbGF0ZUZpbGU6ICd0ZW1wbGF0ZS5qc29uJyxcbiAgICB9LFxuICB9KTtcblxuICB3cml0ZUZpbGVTeW5jKGpvaW4oYXNzZW1ibHkub3V0ZGlyLCAndGVtcGxhdGUuanNvbicpLCBKU09OLnN0cmluZ2lmeSh0ZW1wbGF0ZSkpO1xuICByZXR1cm4gYXNzZW1ibHkuYnVpbGRBc3NlbWJseSgpLmdldFN0YWNrQnlOYW1lKCd0ZXN0Jyk7XG59XG5cbmZ1bmN0aW9uIG1rU29tZVJlc291cmNlKHByb3BzOiBhbnkpOiBjeGFwaS5DbG91ZEZvcm1hdGlvblN0YWNrQXJ0aWZhY3Qge1xuICByZXR1cm4gbWtTdGFjayh7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBTb21lUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgICAgUHJvcGVydGllczogcHJvcHMsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xufSJdfQ==