"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("@aws-cdk/assert/jest");
const codebuild = require("@aws-cdk/aws-codebuild");
const codecommit = require("@aws-cdk/aws-codecommit");
const core_1 = require("@aws-cdk/core");
const amplify = require("../lib");
let stack;
beforeEach(() => {
    stack = new core_1.Stack();
});
test('create an app connected to a GitHub repository', () => {
    // WHEN
    new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        buildSpec: codebuild.BuildSpec.fromObject({
            version: '1.0',
            frontend: {
                phases: {
                    build: {
                        commands: [
                            'npm run build',
                        ],
                    },
                },
            },
        }),
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        Name: 'App',
        BuildSpec: '{\n  \"version\": \"1.0\",\n  \"frontend\": {\n    \"phases\": {\n      \"build\": {\n        \"commands\": [\n          \"npm run build\"\n        ]\n      }\n    }\n  }\n}',
        IAMServiceRole: {
            'Fn::GetAtt': [
                'AppRole1AF9B530',
                'Arn',
            ],
        },
        OauthToken: 'secret',
        Repository: 'https://github.com/aws/aws-cdk',
    });
    expect(stack).toHaveResource('AWS::IAM::Role', {
        AssumeRolePolicyDocument: {
            Statement: [
                {
                    Action: 'sts:AssumeRole',
                    Effect: 'Allow',
                    Principal: {
                        Service: 'amplify.amazonaws.com',
                    },
                },
            ],
            Version: '2012-10-17',
        },
    });
});
test('create an app connected to a CodeCommit repository', () => {
    // WHEN
    new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.CodeCommitSourceCodeProvider({
            repository: codecommit.Repository.fromRepositoryName(stack, 'Repo', 'my-repo'),
        }),
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        IAMServiceRole: {
            'Fn::GetAtt': [
                'AppRole1AF9B530',
                'Arn',
            ],
        },
        Repository: {
            'Fn::Join': [
                '',
                [
                    'https://git-codecommit.',
                    {
                        Ref: 'AWS::Region',
                    },
                    '.',
                    {
                        Ref: 'AWS::URLSuffix',
                    },
                    '/v1/repos/my-repo',
                ],
            ],
        },
    });
    expect(stack).toHaveResource('AWS::IAM::Policy', {
        PolicyDocument: {
            Statement: [
                {
                    Action: 'codecommit:GitPull',
                    Effect: 'Allow',
                    Resource: {
                        'Fn::Join': [
                            '',
                            [
                                'arn:',
                                {
                                    Ref: 'AWS::Partition',
                                },
                                ':codecommit:',
                                {
                                    Ref: 'AWS::Region',
                                },
                                ':',
                                {
                                    Ref: 'AWS::AccountId',
                                },
                                ':my-repo',
                            ],
                        ],
                    },
                },
            ],
            Version: '2012-10-17',
        },
        Roles: [
            {
                Ref: 'AppRole1AF9B530',
            },
        ],
    });
});
test('with basic auth from credentials', () => {
    // WHEN
    new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        basicAuth: amplify.BasicAuth.fromCredentials('username', core_1.SecretValue.plainText('password')),
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        BasicAuthConfig: {
            EnableBasicAuth: true,
            Password: 'password',
            Username: 'username',
        },
    });
});
test('with basic auth from generated password', () => {
    // WHEN
    new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        basicAuth: amplify.BasicAuth.fromGeneratedPassword('username'),
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        BasicAuthConfig: {
            EnableBasicAuth: true,
            Password: {
                'Fn::Join': [
                    '',
                    [
                        '{{resolve:secretsmanager:',
                        {
                            Ref: 'AppAppBasicAuthE743F015',
                        },
                        ':SecretString:password::}}',
                    ],
                ],
            },
            Username: 'username',
        },
    });
    expect(stack).toHaveResource('AWS::SecretsManager::Secret', {
        GenerateSecretString: {
            GenerateStringKey: 'password',
            SecretStringTemplate: '{\"username\":\"username\"}',
        },
    });
});
test('with env vars', () => {
    // WHEN
    const app = new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        environmentVariables: {
            key1: 'value1',
        },
    });
    app.addEnvironment('key2', 'value2');
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        EnvironmentVariables: [
            {
                Name: 'key1',
                Value: 'value1',
            },
            {
                Name: 'key2',
                Value: 'value2',
            },
        ],
    });
});
test('with custom rules', () => {
    // WHEN
    const app = new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        customRules: [
            {
                source: '/source1',
                target: '/target1',
                status: amplify.RedirectStatus.PERMANENT_REDIRECT,
            },
        ],
    });
    app.addCustomRule({
        source: '/source2',
        target: '/target2',
        status: amplify.RedirectStatus.TEMPORARY_REDIRECT,
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        CustomRules: [
            {
                Source: '/source1',
                Status: '301',
                Target: '/target1',
            },
            {
                Source: '/source2',
                Status: '302',
                Target: '/target2',
            },
        ],
    });
});
test('with SPA redirect', () => {
    // WHEN
    new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        customRules: [amplify.CustomRule.SINGLE_PAGE_APPLICATION_REDIRECT],
    });
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        CustomRules: [
            {
                Source: '</^[^.]+$/>',
                Status: '200',
                Target: '/index.html',
            },
        ],
    });
});
test('with auto branch creation', () => {
    // WHEN
    const app = new amplify.App(stack, 'App', {
        sourceCodeProvider: new amplify.GitHubSourceCodeProvider({
            owner: 'aws',
            repository: 'aws-cdk',
            oauthToken: core_1.SecretValue.plainText('secret'),
        }),
        autoBranchCreation: {
            environmentVariables: {
                key1: 'value1',
            },
        },
    });
    app.addAutoBranchEnvironment('key2', 'value2');
    // THEN
    expect(stack).toHaveResource('AWS::Amplify::App', {
        AutoBranchCreationConfig: {
            EnableAutoBranchCreation: true,
            EnableAutoBuild: true,
            EnablePullRequestPreview: true,
            EnvironmentVariables: [
                {
                    Name: 'key1',
                    Value: 'value1',
                },
                {
                    Name: 'key2',
                    Value: 'value2',
                },
            ],
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhcHAudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGdDQUE4QjtBQUM5QixvREFBb0Q7QUFDcEQsc0RBQXNEO0FBQ3RELHdDQUFtRDtBQUNuRCxrQ0FBa0M7QUFFbEMsSUFBSSxLQUFZLENBQUM7QUFDakIsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0FBQ3RCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtJQUMxRCxPQUFPO0lBQ1AsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUU7UUFDNUIsa0JBQWtCLEVBQUUsSUFBSSxPQUFPLENBQUMsd0JBQXdCLENBQUM7WUFDdkQsS0FBSyxFQUFFLEtBQUs7WUFDWixVQUFVLEVBQUUsU0FBUztZQUNyQixVQUFVLEVBQUUsa0JBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO1NBQzVDLENBQUM7UUFDRixTQUFTLEVBQUUsU0FBUyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7WUFDeEMsT0FBTyxFQUFFLEtBQUs7WUFDZCxRQUFRLEVBQUU7Z0JBQ1IsTUFBTSxFQUFFO29CQUNOLEtBQUssRUFBRTt3QkFDTCxRQUFRLEVBQUU7NEJBQ1IsZUFBZTt5QkFDaEI7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyxtQkFBbUIsRUFBRTtRQUNoRCxJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsRUFBRSwrS0FBK0s7UUFDMUwsY0FBYyxFQUFFO1lBQ2QsWUFBWSxFQUFFO2dCQUNaLGlCQUFpQjtnQkFDakIsS0FBSzthQUNOO1NBQ0Y7UUFDRCxVQUFVLEVBQUUsUUFBUTtRQUNwQixVQUFV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LEdBQUcsRUFBRTtJQUNyQyxPQUFPO0lBQ1AsTUFBTSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUU7UUFDeEMsa0JBQWtCLEVBQUUsSUFBSSxPQUFPLENBQUMsd0JBQXdCLENBQUM7WUFDdkQsS0FBSyxFQUFFLEtBQUs7WUFDWixVQUFVLEVBQUUsU0FBUztZQUNyQixVQUFVLEVBQUUsa0JBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO1NBQzVDLENBQUM7UUFDRixrQkFBa0IsRUFBRTtZQUNsQixvQkFBb0IsRUFBRTtnQkFDcEIsSUFBSSxFQUFFLFFBQVE7YUFDZjtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUUvQyxPQUFPO0lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyxtQkFBbUIsRUFBRTtRQUNoRCx3QkFBd0IsRUFBRTtZQUN4Qix3QkFBd0IsRUFBRSxJQUFJO1lBQzlCLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLHdCQUF3QixFQUFFLElBQUk7WUFDOUIsb0JBQW9CLEVBQUU7Z0JBQ3BCO29CQUNFLElBQUksRUFBRSxNQUFNO29CQUNaLEtBQUssRUFBRSxRQUFRO2lCQUNoQjtnQkFDRDtvQkFDRSxJQUFJLEVBQUUsTUFBTTtvQkFDWixLQUFLLEVBQUUsUUFBUTtpQkFDaEI7YUFDRjtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ0Bhd3MtY2RrL2Fzc2VydC9qZXN0JztcbmltcG9ydCAqIGFzIGNvZGVidWlsZCBmcm9tICdAYXdzLWNkay9hd3MtY29kZWJ1aWxkJztcbmltcG9ydCAqIGFzIGNvZGVjb21taXQgZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVjb21taXQnO1xuaW1wb3J0IHsgU2VjcmV0VmFsdWUsIFN0YWNrIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgKiBhcyBhbXBsaWZ5IGZyb20gJy4uL2xpYic7XG5cbmxldCBzdGFjazogU3RhY2s7XG5iZWZvcmVFYWNoKCgpID0+IHtcbiAgc3RhY2sgPSBuZXcgU3RhY2soKTtcbn0pO1xuXG50ZXN0KCdjcmVhdGUgYW4gYXBwIGNvbm5lY3RlZCB0byBhIEdpdEh1YiByZXBvc2l0b3J5JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBhbXBsaWZ5LkFwcChzdGFjaywgJ0FwcCcsIHtcbiAgICBzb3VyY2VDb2RlUHJvdmlkZXI6IG5ldyBhbXBsaWZ5LkdpdEh1YlNvdXJjZUNvZGVQcm92aWRlcih7XG4gICAgICBvd25lcjogJ2F3cycsXG4gICAgICByZXBvc2l0b3J5OiAnYXdzLWNkaycsXG4gICAgICBvYXV0aFRva2VuOiBTZWNyZXRWYWx1ZS5wbGFpblRleHQoJ3NlY3JldCcpLFxuICAgIH0pLFxuICAgIGJ1aWxkU3BlYzogY29kZWJ1aWxkLkJ1aWxkU3BlYy5mcm9tT2JqZWN0KHtcbiAgICAgIHZlcnNpb246ICcxLjAnLFxuICAgICAgZnJvbnRlbmQ6IHtcbiAgICAgICAgcGhhc2VzOiB7XG4gICAgICAgICAgYnVpbGQ6IHtcbiAgICAgICAgICAgIGNvbW1hbmRzOiBbXG4gICAgICAgICAgICAgICducG0gcnVuIGJ1aWxkJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpBbXBsaWZ5OjpBcHAnLCB7XG4gICAgTmFtZTogJ0FwcCcsXG4gICAgQnVpbGRTcGVjOiAne1xcbiAgXFxcInZlcnNpb25cXFwiOiBcXFwiMS4wXFxcIixcXG4gIFxcXCJmcm9udGVuZFxcXCI6IHtcXG4gICAgXFxcInBoYXNlc1xcXCI6IHtcXG4gICAgICBcXFwiYnVpbGRcXFwiOiB7XFxuICAgICAgICBcXFwiY29tbWFuZHNcXFwiOiBbXFxuICAgICAgICAgIFxcXCJucG0gcnVuIGJ1aWxkXFxcIlxcbiAgICAgICAgXVxcbiAgICAgIH1cXG4gICAgfVxcbiAgfVxcbn0nLFxuICAgIElBTVNlcnZpY2VSb2xlOiB7XG4gICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgJ0FwcFJvbGUxQUY5QjUzMCcsXG4gICAgICAgICdBcm4nLFxuICAgICAgXSxcbiAgICB9LFxuICAgIE9hdXRoVG9rZW46ICdzZWNyZXQnLFxuICAgIFJlcG9zaXRvcnk6ICdodHRwczovL2dpdGh1Yi5jb20vYXdzL2F3cy1jZGsnLFxuICB9KTtcblxuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdBV1M6OklBTTo6Um9sZScsIHtcbiAgICBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICB7XG4gICAgICAgICAgQWN0aW9uOiAnc3RzOkFzc3VtZVJvbGUnLFxuICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgIFNlcnZpY2U6ICdhbXBsaWZ5LmFtYXpvbmF3cy5jb20nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgVmVyc2lvbjogJzIwMTItMTAtMTcnLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2NyZWF0ZSBhbiBhcHAgY29ubmVjdGVkIHRvIGEgQ29kZUNvbW1pdCByZXBvc2l0b3J5JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBhbXBsaWZ5LkFwcChzdGFjaywgJ0FwcCcsIHtcbiAgICBzb3VyY2VDb2RlUHJvdmlkZXI6IG5ldyBhbXBsaWZ5LkNvZGVDb21taXRTb3VyY2VDb2RlUHJvdmlkZXIoe1xuICAgICAgcmVwb3NpdG9yeTogY29kZWNvbW1pdC5SZXBvc2l0b3J5LmZyb21SZXBvc2l0b3J5TmFtZShzdGFjaywgJ1JlcG8nLCAnbXktcmVwbycpLFxuICAgIH0pLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0FXUzo6QW1wbGlmeTo6QXBwJywge1xuICAgIElBTVNlcnZpY2VSb2xlOiB7XG4gICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgJ0FwcFJvbGUxQUY5QjUzMCcsXG4gICAgICAgICdBcm4nLFxuICAgICAgXSxcbiAgICB9LFxuICAgIFJlcG9zaXRvcnk6IHtcbiAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgJycsXG4gICAgICAgIFtcbiAgICAgICAgICAnaHR0cHM6Ly9naXQtY29kZWNvbW1pdC4nLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlZjogJ0FXUzo6UmVnaW9uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgICcuJyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWY6ICdBV1M6OlVSTFN1ZmZpeCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnL3YxL3JlcG9zL215LXJlcG8nLFxuICAgICAgICBdLFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcblxuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAge1xuICAgICAgICAgIEFjdGlvbjogJ2NvZGVjb21taXQ6R2l0UHVsbCcsXG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgICAnRm46OkpvaW4nOiBbXG4gICAgICAgICAgICAgICcnLFxuICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgJ2FybjonLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIFJlZjogJ0FXUzo6UGFydGl0aW9uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICc6Y29kZWNvbW1pdDonLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIFJlZjogJ0FXUzo6UmVnaW9uJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICc6JyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBSZWY6ICdBV1M6OkFjY291bnRJZCcsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAnOm15LXJlcG8nLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICB9LFxuICAgIFJvbGVzOiBbXG4gICAgICB7XG4gICAgICAgIFJlZjogJ0FwcFJvbGUxQUY5QjUzMCcsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3dpdGggYmFzaWMgYXV0aCBmcm9tIGNyZWRlbnRpYWxzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBhbXBsaWZ5LkFwcChzdGFjaywgJ0FwcCcsIHtcbiAgICBzb3VyY2VDb2RlUHJvdmlkZXI6IG5ldyBhbXBsaWZ5LkdpdEh1YlNvdXJjZUNvZGVQcm92aWRlcih7XG4gICAgICBvd25lcjogJ2F3cycsXG4gICAgICByZXBvc2l0b3J5OiAnYXdzLWNkaycsXG4gICAgICBvYXV0aFRva2VuOiBTZWNyZXRWYWx1ZS5wbGFpblRleHQoJ3NlY3JldCcpLFxuICAgIH0pLFxuICAgIGJhc2ljQXV0aDogYW1wbGlmeS5CYXNpY0F1dGguZnJvbUNyZWRlbnRpYWxzKCd1c2VybmFtZScsIFNlY3JldFZhbHVlLnBsYWluVGV4dCgncGFzc3dvcmQnKSksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpBbXBsaWZ5OjpBcHAnLCB7XG4gICAgQmFzaWNBdXRoQ29uZmlnOiB7XG4gICAgICBFbmFibGVCYXNpY0F1dGg6IHRydWUsXG4gICAgICBQYXNzd29yZDogJ3Bhc3N3b3JkJyxcbiAgICAgIFVzZXJuYW1lOiAndXNlcm5hbWUnLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3dpdGggYmFzaWMgYXV0aCBmcm9tIGdlbmVyYXRlZCBwYXNzd29yZCcsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgYW1wbGlmeS5BcHAoc3RhY2ssICdBcHAnLCB7XG4gICAgc291cmNlQ29kZVByb3ZpZGVyOiBuZXcgYW1wbGlmeS5HaXRIdWJTb3VyY2VDb2RlUHJvdmlkZXIoe1xuICAgICAgb3duZXI6ICdhd3MnLFxuICAgICAgcmVwb3NpdG9yeTogJ2F3cy1jZGsnLFxuICAgICAgb2F1dGhUb2tlbjogU2VjcmV0VmFsdWUucGxhaW5UZXh0KCdzZWNyZXQnKSxcbiAgICB9KSxcbiAgICBiYXNpY0F1dGg6IGFtcGxpZnkuQmFzaWNBdXRoLmZyb21HZW5lcmF0ZWRQYXNzd29yZCgndXNlcm5hbWUnKSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdBV1M6OkFtcGxpZnk6OkFwcCcsIHtcbiAgICBCYXNpY0F1dGhDb25maWc6IHtcbiAgICAgIEVuYWJsZUJhc2ljQXV0aDogdHJ1ZSxcbiAgICAgIFBhc3N3b3JkOiB7XG4gICAgICAgICdGbjo6Sm9pbic6IFtcbiAgICAgICAgICAnJyxcbiAgICAgICAgICBbXG4gICAgICAgICAgICAne3tyZXNvbHZlOnNlY3JldHNtYW5hZ2VyOicsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFJlZjogJ0FwcEFwcEJhc2ljQXV0aEU3NDNGMDE1JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnOlNlY3JldFN0cmluZzpwYXNzd29yZDo6fX0nLFxuICAgICAgICAgIF0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICAgVXNlcm5hbWU6ICd1c2VybmFtZScsXG4gICAgfSxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpTZWNyZXRzTWFuYWdlcjo6U2VjcmV0Jywge1xuICAgIEdlbmVyYXRlU2VjcmV0U3RyaW5nOiB7XG4gICAgICBHZW5lcmF0ZVN0cmluZ0tleTogJ3Bhc3N3b3JkJyxcbiAgICAgIFNlY3JldFN0cmluZ1RlbXBsYXRlOiAne1xcXCJ1c2VybmFtZVxcXCI6XFxcInVzZXJuYW1lXFxcIn0nLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3dpdGggZW52IHZhcnMnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYXBwID0gbmV3IGFtcGxpZnkuQXBwKHN0YWNrLCAnQXBwJywge1xuICAgIHNvdXJjZUNvZGVQcm92aWRlcjogbmV3IGFtcGxpZnkuR2l0SHViU291cmNlQ29kZVByb3ZpZGVyKHtcbiAgICAgIG93bmVyOiAnYXdzJyxcbiAgICAgIHJlcG9zaXRvcnk6ICdhd3MtY2RrJyxcbiAgICAgIG9hdXRoVG9rZW46IFNlY3JldFZhbHVlLnBsYWluVGV4dCgnc2VjcmV0JyksXG4gICAgfSksXG4gICAgZW52aXJvbm1lbnRWYXJpYWJsZXM6IHtcbiAgICAgIGtleTE6ICd2YWx1ZTEnLFxuICAgIH0sXG4gIH0pO1xuICBhcHAuYWRkRW52aXJvbm1lbnQoJ2tleTInLCAndmFsdWUyJyk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3Qoc3RhY2spLnRvSGF2ZVJlc291cmNlKCdBV1M6OkFtcGxpZnk6OkFwcCcsIHtcbiAgICBFbnZpcm9ubWVudFZhcmlhYmxlczogW1xuICAgICAge1xuICAgICAgICBOYW1lOiAna2V5MScsXG4gICAgICAgIFZhbHVlOiAndmFsdWUxJyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIE5hbWU6ICdrZXkyJyxcbiAgICAgICAgVmFsdWU6ICd2YWx1ZTInLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG50ZXN0KCd3aXRoIGN1c3RvbSBydWxlcycsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBhcHAgPSBuZXcgYW1wbGlmeS5BcHAoc3RhY2ssICdBcHAnLCB7XG4gICAgc291cmNlQ29kZVByb3ZpZGVyOiBuZXcgYW1wbGlmeS5HaXRIdWJTb3VyY2VDb2RlUHJvdmlkZXIoe1xuICAgICAgb3duZXI6ICdhd3MnLFxuICAgICAgcmVwb3NpdG9yeTogJ2F3cy1jZGsnLFxuICAgICAgb2F1dGhUb2tlbjogU2VjcmV0VmFsdWUucGxhaW5UZXh0KCdzZWNyZXQnKSxcbiAgICB9KSxcbiAgICBjdXN0b21SdWxlczogW1xuICAgICAge1xuICAgICAgICBzb3VyY2U6ICcvc291cmNlMScsXG4gICAgICAgIHRhcmdldDogJy90YXJnZXQxJyxcbiAgICAgICAgc3RhdHVzOiBhbXBsaWZ5LlJlZGlyZWN0U3RhdHVzLlBFUk1BTkVOVF9SRURJUkVDVCxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG4gIGFwcC5hZGRDdXN0b21SdWxlKHtcbiAgICBzb3VyY2U6ICcvc291cmNlMicsXG4gICAgdGFyZ2V0OiAnL3RhcmdldDInLFxuICAgIHN0YXR1czogYW1wbGlmeS5SZWRpcmVjdFN0YXR1cy5URU1QT1JBUllfUkVESVJFQ1QsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpBbXBsaWZ5OjpBcHAnLCB7XG4gICAgQ3VzdG9tUnVsZXM6IFtcbiAgICAgIHtcbiAgICAgICAgU291cmNlOiAnL3NvdXJjZTEnLFxuICAgICAgICBTdGF0dXM6ICczMDEnLFxuICAgICAgICBUYXJnZXQ6ICcvdGFyZ2V0MScsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBTb3VyY2U6ICcvc291cmNlMicsXG4gICAgICAgIFN0YXR1czogJzMwMicsXG4gICAgICAgIFRhcmdldDogJy90YXJnZXQyJyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG59KTtcblxudGVzdCgnd2l0aCBTUEEgcmVkaXJlY3QnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IGFtcGxpZnkuQXBwKHN0YWNrLCAnQXBwJywge1xuICAgIHNvdXJjZUNvZGVQcm92aWRlcjogbmV3IGFtcGxpZnkuR2l0SHViU291cmNlQ29kZVByb3ZpZGVyKHtcbiAgICAgIG93bmVyOiAnYXdzJyxcbiAgICAgIHJlcG9zaXRvcnk6ICdhd3MtY2RrJyxcbiAgICAgIG9hdXRoVG9rZW46IFNlY3JldFZhbHVlLnBsYWluVGV4dCgnc2VjcmV0JyksXG4gICAgfSksXG4gICAgY3VzdG9tUnVsZXM6IFthbXBsaWZ5LkN1c3RvbVJ1bGUuU0lOR0xFX1BBR0VfQVBQTElDQVRJT05fUkVESVJFQ1RdLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGFjaykudG9IYXZlUmVzb3VyY2UoJ0FXUzo6QW1wbGlmeTo6QXBwJywge1xuICAgIEN1c3RvbVJ1bGVzOiBbXG4gICAgICB7XG4gICAgICAgIFNvdXJjZTogJzwvXlteLl0rJC8+JyxcbiAgICAgICAgU3RhdHVzOiAnMjAwJyxcbiAgICAgICAgVGFyZ2V0OiAnL2luZGV4Lmh0bWwnLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG50ZXN0KCd3aXRoIGF1dG8gYnJhbmNoIGNyZWF0aW9uJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFwcCA9IG5ldyBhbXBsaWZ5LkFwcChzdGFjaywgJ0FwcCcsIHtcbiAgICBzb3VyY2VDb2RlUHJvdmlkZXI6IG5ldyBhbXBsaWZ5LkdpdEh1YlNvdXJjZUNvZGVQcm92aWRlcih7XG4gICAgICBvd25lcjogJ2F3cycsXG4gICAgICByZXBvc2l0b3J5OiAnYXdzLWNkaycsXG4gICAgICBvYXV0aFRva2VuOiBTZWNyZXRWYWx1ZS5wbGFpblRleHQoJ3NlY3JldCcpLFxuICAgIH0pLFxuICAgIGF1dG9CcmFuY2hDcmVhdGlvbjoge1xuICAgICAgZW52aXJvbm1lbnRWYXJpYWJsZXM6IHtcbiAgICAgICAga2V5MTogJ3ZhbHVlMScsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICBhcHAuYWRkQXV0b0JyYW5jaEVudmlyb25tZW50KCdrZXkyJywgJ3ZhbHVlMicpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YWNrKS50b0hhdmVSZXNvdXJjZSgnQVdTOjpBbXBsaWZ5OjpBcHAnLCB7XG4gICAgQXV0b0JyYW5jaENyZWF0aW9uQ29uZmlnOiB7XG4gICAgICBFbmFibGVBdXRvQnJhbmNoQ3JlYXRpb246IHRydWUsXG4gICAgICBFbmFibGVBdXRvQnVpbGQ6IHRydWUsXG4gICAgICBFbmFibGVQdWxsUmVxdWVzdFByZXZpZXc6IHRydWUsXG4gICAgICBFbnZpcm9ubWVudFZhcmlhYmxlczogW1xuICAgICAgICB7XG4gICAgICAgICAgTmFtZTogJ2tleTEnLFxuICAgICAgICAgIFZhbHVlOiAndmFsdWUxJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIE5hbWU6ICdrZXkyJyxcbiAgICAgICAgICBWYWx1ZTogJ3ZhbHVlMicsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gIH0pO1xufSk7XG4iXX0=