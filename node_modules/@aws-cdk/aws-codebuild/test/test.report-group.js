"use strict";
const assert_1 = require("@aws-cdk/assert");
const iam = require("@aws-cdk/aws-iam");
const kms = require("@aws-cdk/aws-kms");
const s3 = require("@aws-cdk/aws-s3");
const cdk = require("@aws-cdk/core");
const codebuild = require("../lib");
module.exports = {
    'Test Reports Groups': {
        'get created with type=TEST and exportConfig=NO_EXPORT by default'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "NO_EXPORT",
                    "S3Destination": assert_1.ABSENT,
                },
            }));
            test.done();
        },
        'can be imported by name'(test) {
            const stack = new cdk.Stack();
            const reportGroup = codebuild.ReportGroup.fromReportGroupName(stack, 'ReportGroup', 'my-report-group');
            const role = new iam.Role(stack, 'Role', {
                assumedBy: new iam.AnyPrincipal(),
            });
            role.addToPolicy(new iam.PolicyStatement({
                actions: ['codebuild:*'],
                resources: [reportGroup.reportGroupArn],
            }));
            test.equal(reportGroup.reportGroupName, 'my-report-group');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::IAM::Policy', {
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": "codebuild:*",
                            "Resource": {
                                "Fn::Join": ["", [
                                        "arn:",
                                        { "Ref": "AWS::Partition" },
                                        ":codebuild:",
                                        { "Ref": "AWS::Region" },
                                        ":",
                                        { "Ref": "AWS::AccountId" },
                                        ":report-group/my-report-group",
                                    ]],
                            },
                        },
                    ],
                },
            }));
            test.done();
        },
        'specify exportConfig=S3 when providing an exportBucket'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                exportBucket: s3.Bucket.fromBucketName(stack, 'Bucket', 'my-bucket'),
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "S3",
                    "S3Destination": {
                        "Bucket": "my-bucket",
                        "EncryptionKey": assert_1.ABSENT,
                        "EncryptionDisabled": assert_1.ABSENT,
                        "Packaging": assert_1.ABSENT,
                    },
                },
            }));
            test.done();
        },
        'specify encryptionKey in ExportConfig.S3Destination if exportBucket has a Key'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                exportBucket: s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
                    bucketName: 'my-bucket',
                    encryptionKey: kms.Key.fromKeyArn(stack, 'Key', 'arn:aws:kms:us-east-1:123456789012:key/my-key'),
                }),
                zipExport: true,
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "S3",
                    "S3Destination": {
                        "Bucket": "my-bucket",
                        "EncryptionDisabled": false,
                        "EncryptionKey": "arn:aws:kms:us-east-1:123456789012:key/my-key",
                        "Packaging": "ZIP",
                    },
                },
            }));
            test.done();
        },
        'get created with RemovalPolicy.RETAIN by default'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "DeletionPolicy": "Retain",
                "UpdateReplacePolicy": "Retain",
            }, assert_1.ResourcePart.CompleteDefinition));
            test.done();
        },
        'can be created with RemovalPolicy.DESTROY'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                removalPolicy: cdk.RemovalPolicy.DESTROY,
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "DeletionPolicy": "Delete",
                "UpdateReplacePolicy": "Delete",
            }, assert_1.ResourcePart.CompleteDefinition));
            test.done();
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5yZXBvcnQtZ3JvdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0ZXN0LnJlcG9ydC1ncm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNENBQWlGO0FBQ2pGLHdDQUF3QztBQUN4Qyx3Q0FBd0M7QUFDeEMsc0NBQXNDO0FBQ3RDLHFDQUFxQztBQUVyQyxvQ0FBb0M7QUFLcEMsaUJBQVM7SUFDUCxxQkFBcUIsRUFBRTtRQUNyQixrRUFBa0UsQ0FBQyxJQUFVO1lBQzNFLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRTlCLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFFaEQsZUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyx5QkFBZ0IsQ0FBQyw2QkFBNkIsRUFBRTtnQkFDL0QsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsY0FBYyxFQUFFO29CQUNkLGtCQUFrQixFQUFFLFdBQVc7b0JBQy9CLGVBQWUsRUFBRSxlQUFNO2lCQUN4QjthQUNGLENBQUMsQ0FBQyxDQUFDO1lBRUosSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2QsQ0FBQztRQUVELHlCQUF5QixDQUFDLElBQVU7WUFDbEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFOUIsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQ2pFLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBRXBDLE1BQU0sSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO2dCQUN2QyxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsWUFBWSxFQUFFO2FBQ2xDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLENBQUMsZUFB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LEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUU5QixJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBRWhELGVBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMseUJBQWdCLENBQUMsNkJBQTZCLEVBQUU7Z0JBQy9ELGdCQUFnQixFQUFFLFFBQVE7Z0JBQzFCLHFCQUFxQixFQUFFLFFBQVE7YUFDaEMsRUFBRSxxQkFBWSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztZQUVyQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZCxDQUFDO1FBRUQsMkNBQTJDLENBQUMsSUFBVTtZQUNwRCxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUU5QixJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRTtnQkFDOUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTzthQUN6QyxDQUFDLENBQUM7WUFFSCxlQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLHlCQUFnQixDQUFDLDZCQUE2QixFQUFFO2dCQUMvRCxnQkFBZ0IsRUFBRSxRQUFRO2dCQUMxQixxQkFBcUIsRUFBRSxRQUFRO2FBQ2hDLEVBQUUscUJBQVksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7WUFFckMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2QsQ0FBQztLQUNGO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFCU0VOVCwgZXhwZWN0LCBoYXZlUmVzb3VyY2VMaWtlLCBSZXNvdXJjZVBhcnQgfSBmcm9tICdAYXdzLWNkay9hc3NlcnQnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMga21zIGZyb20gJ0Bhd3MtY2RrL2F3cy1rbXMnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnQGF3cy1jZGsvYXdzLXMzJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgKiBhcyBjb2RlYnVpbGQgZnJvbSAnLi4vbGliJztcblxuLy8gdHNsaW50OmRpc2FibGU6b2JqZWN0LWxpdGVyYWwta2V5LXF1b3Rlc1xuLyogZXNsaW50LWRpc2FibGUgcXVvdGVzICovXG5cbmV4cG9ydCA9IHtcbiAgJ1Rlc3QgUmVwb3J0cyBHcm91cHMnOiB7XG4gICAgJ2dldCBjcmVhdGVkIHdpdGggdHlwZT1URVNUIGFuZCBleHBvcnRDb25maWc9Tk9fRVhQT1JUIGJ5IGRlZmF1bHQnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICBuZXcgY29kZWJ1aWxkLlJlcG9ydEdyb3VwKHN0YWNrLCAnUmVwb3J0R3JvdXAnKTtcblxuICAgICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVCdWlsZDo6UmVwb3J0R3JvdXAnLCB7XG4gICAgICAgIFwiVHlwZVwiOiBcIlRFU1RcIixcbiAgICAgICAgXCJFeHBvcnRDb25maWdcIjoge1xuICAgICAgICAgIFwiRXhwb3J0Q29uZmlnVHlwZVwiOiBcIk5PX0VYUE9SVFwiLFxuICAgICAgICAgIFwiUzNEZXN0aW5hdGlvblwiOiBBQlNFTlQsXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnY2FuIGJlIGltcG9ydGVkIGJ5IG5hbWUnKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICBjb25zdCByZXBvcnRHcm91cCA9IGNvZGVidWlsZC5SZXBvcnRHcm91cC5mcm9tUmVwb3J0R3JvdXBOYW1lKHN0YWNrLFxuICAgICAgICAnUmVwb3J0R3JvdXAnLCAnbXktcmVwb3J0LWdyb3VwJyk7XG5cbiAgICAgIGNvbnN0IHJvbGUgPSBuZXcgaWFtLlJvbGUoc3RhY2ssICdSb2xlJywge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uQW55UHJpbmNpcGFsKCksXG4gICAgICB9KTtcbiAgICAgIHJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBhY3Rpb25zOiBbJ2NvZGVidWlsZDoqJ10sXG4gICAgICAgIHJlc291cmNlczogW3JlcG9ydEdyb3VwLnJlcG9ydEdyb3VwQXJuXSxcbiAgICAgIH0pKTtcblxuICAgICAgdGVzdC5lcXVhbChyZXBvcnRHcm91cC5yZXBvcnRHcm91cE5hbWUsICdteS1yZXBvcnQtZ3JvdXAnKTtcbiAgICAgIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpJQU06OlBvbGljeScsIHtcbiAgICAgICAgXCJQb2xpY3lEb2N1bWVudFwiOiB7XG4gICAgICAgICAgXCJTdGF0ZW1lbnRcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcIkFjdGlvblwiOiBcImNvZGVidWlsZDoqXCIsXG4gICAgICAgICAgICAgIFwiUmVzb3VyY2VcIjoge1xuICAgICAgICAgICAgICAgIFwiRm46OkpvaW5cIjogW1wiXCIsIFtcbiAgICAgICAgICAgICAgICAgIFwiYXJuOlwiLFxuICAgICAgICAgICAgICAgICAgeyBcIlJlZlwiOiBcIkFXUzo6UGFydGl0aW9uXCIgfSxcbiAgICAgICAgICAgICAgICAgIFwiOmNvZGVidWlsZDpcIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OlJlZ2lvblwiIH0sXG4gICAgICAgICAgICAgICAgICBcIjpcIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OkFjY291bnRJZFwiIH0sXG4gICAgICAgICAgICAgICAgICBcIjpyZXBvcnQtZ3JvdXAvbXktcmVwb3J0LWdyb3VwXCIsXG4gICAgICAgICAgICAgICAgXV0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnc3BlY2lmeSBleHBvcnRDb25maWc9UzMgd2hlbiBwcm92aWRpbmcgYW4gZXhwb3J0QnVja2V0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgbmV3IGNvZGVidWlsZC5SZXBvcnRHcm91cChzdGFjaywgJ1JlcG9ydEdyb3VwJywge1xuICAgICAgICBleHBvcnRCdWNrZXQ6IHMzLkJ1Y2tldC5mcm9tQnVja2V0TmFtZShzdGFjaywgJ0J1Y2tldCcsICdteS1idWNrZXQnKSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgXCJUeXBlXCI6IFwiVEVTVFwiLFxuICAgICAgICBcIkV4cG9ydENvbmZpZ1wiOiB7XG4gICAgICAgICAgXCJFeHBvcnRDb25maWdUeXBlXCI6IFwiUzNcIixcbiAgICAgICAgICBcIlMzRGVzdGluYXRpb25cIjoge1xuICAgICAgICAgICAgXCJCdWNrZXRcIjogXCJteS1idWNrZXRcIixcbiAgICAgICAgICAgIFwiRW5jcnlwdGlvbktleVwiOiBBQlNFTlQsXG4gICAgICAgICAgICBcIkVuY3J5cHRpb25EaXNhYmxlZFwiOiBBQlNFTlQsXG4gICAgICAgICAgICBcIlBhY2thZ2luZ1wiOiBBQlNFTlQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcblxuICAgICdzcGVjaWZ5IGVuY3J5cHRpb25LZXkgaW4gRXhwb3J0Q29uZmlnLlMzRGVzdGluYXRpb24gaWYgZXhwb3J0QnVja2V0IGhhcyBhIEtleScodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAgIG5ldyBjb2RlYnVpbGQuUmVwb3J0R3JvdXAoc3RhY2ssICdSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgZXhwb3J0QnVja2V0OiBzMy5CdWNrZXQuZnJvbUJ1Y2tldEF0dHJpYnV0ZXMoc3RhY2ssICdCdWNrZXQnLCB7XG4gICAgICAgICAgYnVja2V0TmFtZTogJ215LWJ1Y2tldCcsXG4gICAgICAgICAgZW5jcnlwdGlvbktleToga21zLktleS5mcm9tS2V5QXJuKHN0YWNrLCAnS2V5JyxcbiAgICAgICAgICAgICdhcm46YXdzOmttczp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmtleS9teS1rZXknKSxcbiAgICAgICAgfSksXG4gICAgICAgIHppcEV4cG9ydDogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgXCJUeXBlXCI6IFwiVEVTVFwiLFxuICAgICAgICBcIkV4cG9ydENvbmZpZ1wiOiB7XG4gICAgICAgICAgXCJFeHBvcnRDb25maWdUeXBlXCI6IFwiUzNcIixcbiAgICAgICAgICBcIlMzRGVzdGluYXRpb25cIjoge1xuICAgICAgICAgICAgXCJCdWNrZXRcIjogXCJteS1idWNrZXRcIixcbiAgICAgICAgICAgIFwiRW5jcnlwdGlvbkRpc2FibGVkXCI6IGZhbHNlLFxuICAgICAgICAgICAgXCJFbmNyeXB0aW9uS2V5XCI6IFwiYXJuOmF3czprbXM6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjprZXkvbXkta2V5XCIsXG4gICAgICAgICAgICBcIlBhY2thZ2luZ1wiOiBcIlpJUFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnZ2V0IGNyZWF0ZWQgd2l0aCBSZW1vdmFsUG9saWN5LlJFVEFJTiBieSBkZWZhdWx0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgbmV3IGNvZGVidWlsZC5SZXBvcnRHcm91cChzdGFjaywgJ1JlcG9ydEdyb3VwJyk7XG5cbiAgICAgIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlQnVpbGQ6OlJlcG9ydEdyb3VwJywge1xuICAgICAgICBcIkRlbGV0aW9uUG9saWN5XCI6IFwiUmV0YWluXCIsXG4gICAgICAgIFwiVXBkYXRlUmVwbGFjZVBvbGljeVwiOiBcIlJldGFpblwiLFxuICAgICAgfSwgUmVzb3VyY2VQYXJ0LkNvbXBsZXRlRGVmaW5pdGlvbikpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ2NhbiBiZSBjcmVhdGVkIHdpdGggUmVtb3ZhbFBvbGljeS5ERVNUUk9ZJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgbmV3IGNvZGVidWlsZC5SZXBvcnRHcm91cChzdGFjaywgJ1JlcG9ydEdyb3VwJywge1xuICAgICAgICByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5ERVNUUk9ZLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlQnVpbGQ6OlJlcG9ydEdyb3VwJywge1xuICAgICAgICBcIkRlbGV0aW9uUG9saWN5XCI6IFwiRGVsZXRlXCIsXG4gICAgICAgIFwiVXBkYXRlUmVwbGFjZVBvbGljeVwiOiBcIkRlbGV0ZVwiLFxuICAgICAgfSwgUmVzb3VyY2VQYXJ0LkNvbXBsZXRlRGVmaW5pdGlvbikpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuICB9LFxufTtcbiJdfQ==