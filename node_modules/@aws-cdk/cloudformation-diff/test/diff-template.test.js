"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const diff_template_1 = require("../lib/diff-template");
const POLICY_DOCUMENT = { foo: 'Bar' }; // Obviously a fake one!
const BUCKET_POLICY_RESOURCE = {
    Type: 'AWS::S3::BucketPolicy',
    Properties: {
        PolicyDocument: POLICY_DOCUMENT,
        Bucket: { Ref: 'BucketResource' },
    },
};
test('when there is no difference', () => {
    const bucketName = 'ShineyBucketName';
    const currentTemplate = {
        Resources: {
            BucketPolicyResource: BUCKET_POLICY_RESOURCE,
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: bucketName,
                },
            },
        },
    };
    // Making a JSON-clone, because === is cheating!
    const newTemplate = JSON.parse(JSON.stringify(currentTemplate));
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(0);
});
test('when a resource is created', () => {
    const currentTemplate = { Resources: {} };
    const newTemplate = { Resources: { BucketResource: { Type: 'AWS::S3::Bucket' } } };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.isAddition).toBeTruthy();
    expect(difference === null || difference === void 0 ? void 0 : difference.newResourceType).toEqual('AWS::S3::Bucket');
    expect(difference === null || difference === void 0 ? void 0 : difference.changeImpact).toBe(diff_template_1.ResourceImpact.WILL_CREATE);
});
test('when a resource is deleted (no DeletionPolicy)', () => {
    const currentTemplate = {
        Resources: {
            BucketResource: { Type: 'AWS::S3::Bucket' },
            BucketPolicyResource: BUCKET_POLICY_RESOURCE,
        },
    };
    const newTemplate = {
        Resources: {
            BucketResource: { Type: 'AWS::S3::Bucket' },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketPolicyResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.isRemoval).toBeTruthy();
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::S3::BucketPolicy');
    expect(difference === null || difference === void 0 ? void 0 : difference.changeImpact).toBe(diff_template_1.ResourceImpact.WILL_DESTROY);
});
test('when a resource is deleted (DeletionPolicy=Retain)', () => {
    const currentTemplate = {
        Resources: {
            BucketResource: { Type: 'AWS::S3::Bucket' },
            BucketPolicyResource: {
                Type: 'AWS::S3::BucketPolicy',
                DeletionPolicy: 'Retain',
                Properties: {
                    PolicyDocument: POLICY_DOCUMENT,
                    Bucket: { Ref: 'BucketResource' },
                },
            },
        },
    };
    const newTemplate = {
        Resources: { BucketResource: { Type: 'AWS::S3::Bucket' } },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketPolicyResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.isRemoval).toBeTruthy();
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::S3::BucketPolicy');
    expect(difference === null || difference === void 0 ? void 0 : difference.changeImpact).toBe(diff_template_1.ResourceImpact.WILL_ORPHAN);
});
test('when a property changes', () => {
    const bucketName = 'ShineyBucketName';
    const currentTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: bucketName,
                },
            },
        },
    };
    const newBucketName = `${bucketName}-v2`;
    const newTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: newBucketName,
                },
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::S3::Bucket');
    expect(difference === null || difference === void 0 ? void 0 : difference.propertyUpdates).toEqual({
        BucketName: { oldValue: bucketName, newValue: newBucketName, changeImpact: diff_template_1.ResourceImpact.WILL_REPLACE, isDifferent: true },
    });
});
test('change in dependencies counts as a simple update', () => {
    // GIVEN
    const currentTemplate = {
        Resources: {
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                DependsOn: ['SomeResource'],
            },
        },
    };
    // WHEN
    const newTemplate = {
        Resources: {
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                DependsOn: ['SomeResource', 'SomeOtherResource'],
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    // THEN
    expect(differences.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference === null || difference === void 0 ? void 0 : difference.changeImpact).toBe(diff_template_1.ResourceImpact.WILL_UPDATE);
});
test('when a property is deleted', () => {
    const bucketName = 'ShineyBucketName';
    const currentTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: bucketName,
                },
            },
        },
    };
    const newTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::S3::Bucket');
    expect(difference === null || difference === void 0 ? void 0 : difference.propertyUpdates).toEqual({
        BucketName: { oldValue: bucketName, newValue: undefined, changeImpact: diff_template_1.ResourceImpact.WILL_REPLACE, isDifferent: true },
    });
});
test('when a property is added', () => {
    const bucketName = 'ShineyBucketName';
    const currentTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
            },
        },
    };
    const newTemplate = {
        Resources: {
            QueueResource: {
                Type: 'AWS::SQS::Queue',
            },
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: bucketName,
                },
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference).not.toBeUndefined();
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::S3::Bucket');
    expect(difference === null || difference === void 0 ? void 0 : difference.propertyUpdates).toEqual({
        BucketName: { oldValue: undefined, newValue: bucketName, changeImpact: diff_template_1.ResourceImpact.WILL_REPLACE, isDifferent: true },
    });
});
test('when a resource type changed', () => {
    const currentTemplate = {
        Resources: {
            BucketResource: {
                Type: 'AWS::IAM::Policy',
                Properties: {
                    PolicyName: 'PolicyName',
                },
            },
        },
    };
    const newTemplate = {
        Resources: {
            BucketResource: {
                Type: 'AWS::S3::Bucket',
                Properties: {
                    BucketName: 'BucketName',
                },
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    expect(differences.differenceCount).toBe(1);
    expect(differences.resources.differenceCount).toBe(1);
    const difference = differences.resources.changes.BucketResource;
    expect(difference).not.toBe(undefined);
    expect(difference === null || difference === void 0 ? void 0 : difference.oldResourceType).toEqual('AWS::IAM::Policy');
    expect(difference === null || difference === void 0 ? void 0 : difference.newResourceType).toEqual('AWS::S3::Bucket');
    expect(difference === null || difference === void 0 ? void 0 : difference.changeImpact).toBe(diff_template_1.ResourceImpact.WILL_REPLACE);
});
test('resource replacement is tracked through references', () => {
    // If a resource is replaced, then that change shows that references are
    // going to change. This may lead to replacement of downstream resources
    // if the reference is used in an immutable property, and so on.
    // GIVEN
    const currentTemplate = {
        Resources: {
            Bucket: {
                Type: 'AWS::S3::Bucket',
                Properties: { BucketName: 'Name1' },
            },
            Queue: {
                Type: 'AWS::SQS::Queue',
                Properties: { QueueName: { Ref: 'Bucket' } },
            },
            Topic: {
                Type: 'AWS::SNS::Topic',
                Properties: { TopicName: { Ref: 'Queue' } },
            },
        },
    };
    // WHEN
    const newTemplate = {
        Resources: {
            Bucket: {
                Type: 'AWS::S3::Bucket',
                Properties: { BucketName: 'Name2' },
            },
            Queue: {
                Type: 'AWS::SQS::Queue',
                Properties: { QueueName: { Ref: 'Bucket' } },
            },
            Topic: {
                Type: 'AWS::SNS::Topic',
                Properties: { TopicName: { Ref: 'Queue' } },
            },
        },
    };
    const differences = diff_template_1.diffTemplate(currentTemplate, newTemplate);
    // THEN
    expect(differences.resources.differenceCount).toBe(3);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlmZi10ZW1wbGF0ZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGlmZi10ZW1wbGF0ZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0RBQW9FO0FBRXBFLE1BQU0sZUFBZSxHQUFHLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsd0JBQXdCO0FBQ2hFLE1BQU0sc0JBQXNCLEdBQUc7SUFDN0IsSUFBSSxFQUFFLHVCQUF1QjtJQUM3QixVQUFVLEVBQUU7UUFDVixjQUFjLEVBQUUsZUFBZTtRQUMvQixNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUU7S0FDbEM7Q0FDRixDQUFDO0FBRUYsSUFBSSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUN2QyxNQUFNLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQztJQUN0QyxNQUFNLGVBQWUsR0FBRztRQUN0QixTQUFTLEVBQUU7WUFDVCxvQkFBb0IsRUFBRSxzQkFBc0I7WUFDNUMsY0FBYyxFQUFFO2dCQUNkLElBQUksRUFBRSxpQkFBaUI7Z0JBQ3ZCLFVBQVUsRUFBRTtvQkFDVixVQUFVLEVBQUUsVUFBVTtpQkFDdkI7YUFDRjtTQUNGO0tBQ0YsQ0FBQztJQUNGLGdEQUFnRDtJQUNoRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztJQUVoRSxNQUFNLFdBQVcsR0FBRyw0QkFBWSxDQUFDLGVBQWUsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM5QyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7SUFDdEMsTUFBTSxlQUFlLEdBQUcsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFF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O0lBQ1AsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGlmZlRlbXBsYXRlLCBSZXNvdXJjZUltcGFjdCB9IGZyb20gJy4uL2xpYi9kaWZmLXRlbXBsYXRlJztcblxuY29uc3QgUE9MSUNZX0RPQ1VNRU5UID0geyBmb286ICdCYXInIH07IC8vIE9idmlvdXNseSBhIGZha2Ugb25lIVxuY29uc3QgQlVDS0VUX1BPTElDWV9SRVNPVVJDRSA9IHtcbiAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldFBvbGljeScsXG4gIFByb3BlcnRpZXM6IHtcbiAgICBQb2xpY3lEb2N1bWVudDogUE9MSUNZX0RPQ1VNRU5ULFxuICAgIEJ1Y2tldDogeyBSZWY6ICdCdWNrZXRSZXNvdXJjZScgfSxcbiAgfSxcbn07XG5cbnRlc3QoJ3doZW4gdGhlcmUgaXMgbm8gZGlmZmVyZW5jZScsICgpID0+IHtcbiAgY29uc3QgYnVja2V0TmFtZSA9ICdTaGluZXlCdWNrZXROYW1lJztcbiAgY29uc3QgY3VycmVudFRlbXBsYXRlID0ge1xuICAgIFJlc291cmNlczoge1xuICAgICAgQnVja2V0UG9saWN5UmVzb3VyY2U6IEJVQ0tFVF9QT0xJQ1lfUkVTT1VSQ0UsXG4gICAgICBCdWNrZXRSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIEJ1Y2tldE5hbWU6IGJ1Y2tldE5hbWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG4gIC8vIE1ha2luZyBhIEpTT04tY2xvbmUsIGJlY2F1c2UgPT09IGlzIGNoZWF0aW5nIVxuICBjb25zdCBuZXdUZW1wbGF0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY3VycmVudFRlbXBsYXRlKSk7XG5cbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmVGVtcGxhdGUoY3VycmVudFRlbXBsYXRlLCBuZXdUZW1wbGF0ZSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMCk7XG59KTtcblxudGVzdCgnd2hlbiBhIHJlc291cmNlIGlzIGNyZWF0ZWQnLCAoKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRUZW1wbGF0ZSA9IHsgUmVzb3VyY2VzOiB7fSB9O1xuXG4gIGNvbnN0IG5ld1RlbXBsYXRlID0geyBSZXNvdXJjZXM6IHsgQnVja2V0UmVzb3VyY2U6IHsgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcgfSB9IH07XG5cbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmVGVtcGxhdGUoY3VycmVudFRlbXBsYXRlLCBuZXdUZW1wbGF0ZSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5yZXNvdXJjZXMuZGlmZmVyZW5jZUNvdW50KS50b0JlKDEpO1xuICBjb25zdCBkaWZmZXJlbmNlID0gZGlmZmVyZW5jZXMucmVzb3VyY2VzLmNoYW5nZXMuQnVja2V0UmVzb3VyY2U7XG4gIGV4cGVjdChkaWZmZXJlbmNlKS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8uaXNBZGRpdGlvbikudG9CZVRydXRoeSgpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8ubmV3UmVzb3VyY2VUeXBlKS50b0VxdWFsKCdBV1M6OlMzOjpCdWNrZXQnKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/LmNoYW5nZUltcGFjdCkudG9CZShSZXNvdXJjZUltcGFjdC5XSUxMX0NSRUFURSk7XG59KTtcblxudGVzdCgnd2hlbiBhIHJlc291cmNlIGlzIGRlbGV0ZWQgKG5vIERlbGV0aW9uUG9saWN5KScsICgpID0+IHtcbiAgY29uc3QgY3VycmVudFRlbXBsYXRlID0ge1xuICAgIFJlc291cmNlczoge1xuICAgICAgQnVja2V0UmVzb3VyY2U6IHsgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcgfSxcbiAgICAgIEJ1Y2tldFBvbGljeVJlc291cmNlOiBCVUNLRVRfUE9MSUNZX1JFU09VUkNFLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgbmV3VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBCdWNrZXRSZXNvdXJjZTogeyBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyB9LFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmVGVtcGxhdGUoY3VycmVudFRlbXBsYXRlLCBuZXdUZW1wbGF0ZSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5yZXNvdXJjZXMuZGlmZmVyZW5jZUNvdW50KS50b0JlKDEpO1xuICBjb25zdCBkaWZmZXJlbmNlID0gZGlmZmVyZW5jZXMucmVzb3VyY2VzLmNoYW5nZXMuQnVja2V0UG9saWN5UmVzb3VyY2U7XG4gIGV4cGVjdChkaWZmZXJlbmNlKS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8uaXNSZW1vdmFsKS50b0JlVHJ1dGh5KCk7XG4gIGV4cGVjdChkaWZmZXJlbmNlPy5vbGRSZXNvdXJjZVR5cGUpLnRvRXF1YWwoJ0FXUzo6UzM6OkJ1Y2tldFBvbGljeScpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8uY2hhbmdlSW1wYWN0KS50b0JlKFJlc291cmNlSW1wYWN0LldJTExfREVTVFJPWSk7XG59KTtcblxudGVzdCgnd2hlbiBhIHJlc291cmNlIGlzIGRlbGV0ZWQgKERlbGV0aW9uUG9saWN5PVJldGFpbiknLCAoKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIEJ1Y2tldFJlc291cmNlOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnIH0sXG4gICAgICBCdWNrZXRQb2xpY3lSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0UG9saWN5JyxcbiAgICAgICAgRGVsZXRpb25Qb2xpY3k6ICdSZXRhaW4nLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IFBPTElDWV9ET0NVTUVOVCxcbiAgICAgICAgICBCdWNrZXQ6IHsgUmVmOiAnQnVja2V0UmVzb3VyY2UnIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgbmV3VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7IEJ1Y2tldFJlc291cmNlOiB7IFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnIH0gfSxcbiAgfTtcblxuICBjb25zdCBkaWZmZXJlbmNlcyA9IGRpZmZUZW1wbGF0ZShjdXJyZW50VGVtcGxhdGUsIG5ld1RlbXBsYXRlKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2VzLmRpZmZlcmVuY2VDb3VudCkudG9CZSgxKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2VzLnJlc291cmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGNvbnN0IGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlcy5yZXNvdXJjZXMuY2hhbmdlcy5CdWNrZXRQb2xpY3lSZXNvdXJjZTtcbiAgZXhwZWN0KGRpZmZlcmVuY2UpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gIGV4cGVjdChkaWZmZXJlbmNlPy5pc1JlbW92YWwpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/Lm9sZFJlc291cmNlVHlwZSkudG9FcXVhbCgnQVdTOjpTMzo6QnVja2V0UG9saWN5Jyk7XG4gIGV4cGVjdChkaWZmZXJlbmNlPy5jaGFuZ2VJbXBhY3QpLnRvQmUoUmVzb3VyY2VJbXBhY3QuV0lMTF9PUlBIQU4pO1xufSk7XG5cbnRlc3QoJ3doZW4gYSBwcm9wZXJ0eSBjaGFuZ2VzJywgKCkgPT4ge1xuICBjb25zdCBidWNrZXROYW1lID0gJ1NoaW5leUJ1Y2tldE5hbWUnO1xuICBjb25zdCBjdXJyZW50VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBRdWV1ZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlNRUzo6UXVldWUnLFxuICAgICAgfSxcbiAgICAgIEJ1Y2tldFJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgQnVja2V0TmFtZTogYnVja2V0TmFtZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBuZXdCdWNrZXROYW1lID0gYCR7YnVja2V0TmFtZX0tdjJgO1xuICBjb25zdCBuZXdUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFF1ZXVlUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6U1FTOjpRdWV1ZScsXG4gICAgICB9LFxuICAgICAgQnVja2V0UmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcsXG4gICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICBCdWNrZXROYW1lOiBuZXdCdWNrZXROYW1lLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IGRpZmZlcmVuY2VzID0gZGlmZlRlbXBsYXRlKGN1cnJlbnRUZW1wbGF0ZSwgbmV3VGVtcGxhdGUpO1xuICBleHBlY3QoZGlmZmVyZW5jZXMuZGlmZmVyZW5jZUNvdW50KS50b0JlKDEpO1xuICBleHBlY3QoZGlmZmVyZW5jZXMucmVzb3VyY2VzLmRpZmZlcmVuY2VDb3VudCkudG9CZSgxKTtcbiAgY29uc3QgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2VzLnJlc291cmNlcy5jaGFuZ2VzLkJ1Y2tldFJlc291cmNlO1xuICBleHBlY3QoZGlmZmVyZW5jZSkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/Lm9sZFJlc291cmNlVHlwZSkudG9FcXVhbCgnQVdTOjpTMzo6QnVja2V0Jyk7XG4gIGV4cGVjdChkaWZmZXJlbmNlPy5wcm9wZXJ0eVVwZGF0ZXMpLnRvRXF1YWwoe1xuICAgIEJ1Y2tldE5hbWU6IHsgb2xkVmFsdWU6IGJ1Y2tldE5hbWUsIG5ld1ZhbHVlOiBuZXdCdWNrZXROYW1lLCBjaGFuZ2VJbXBhY3Q6IFJlc291cmNlSW1wYWN0LldJTExfUkVQTEFDRSwgaXNEaWZmZXJlbnQ6IHRydWUgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnY2hhbmdlIGluIGRlcGVuZGVuY2llcyBjb3VudHMgYXMgYSBzaW1wbGUgdXBkYXRlJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBjdXJyZW50VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBCdWNrZXRSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgICAgRGVwZW5kc09uOiBbJ1NvbWVSZXNvdXJjZSddLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgbmV3VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBCdWNrZXRSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgICAgRGVwZW5kc09uOiBbJ1NvbWVSZXNvdXJjZScsICdTb21lT3RoZXJSZXNvdXJjZSddLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBkaWZmZXJlbmNlcyA9IGRpZmZUZW1wbGF0ZShjdXJyZW50VGVtcGxhdGUsIG5ld1RlbXBsYXRlKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChkaWZmZXJlbmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGNvbnN0IGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlcy5yZXNvdXJjZXMuY2hhbmdlcy5CdWNrZXRSZXNvdXJjZTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/LmNoYW5nZUltcGFjdCkudG9CZShSZXNvdXJjZUltcGFjdC5XSUxMX1VQREFURSk7XG59KTtcblxudGVzdCgnd2hlbiBhIHByb3BlcnR5IGlzIGRlbGV0ZWQnLCAoKSA9PiB7XG4gIGNvbnN0IGJ1Y2tldE5hbWUgPSAnU2hpbmV5QnVja2V0TmFtZSc7XG4gIGNvbnN0IGN1cnJlbnRUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFF1ZXVlUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6U1FTOjpRdWV1ZScsXG4gICAgICB9LFxuICAgICAgQnVja2V0UmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcsXG4gICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICBCdWNrZXROYW1lOiBidWNrZXROYW1lLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IG5ld1RlbXBsYXRlID0ge1xuICAgIFJlc291cmNlczoge1xuICAgICAgUXVldWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTUVM6OlF1ZXVlJyxcbiAgICAgIH0sXG4gICAgICBCdWNrZXRSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBkaWZmZXJlbmNlcyA9IGRpZmZUZW1wbGF0ZShjdXJyZW50VGVtcGxhdGUsIG5ld1RlbXBsYXRlKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2VzLmRpZmZlcmVuY2VDb3VudCkudG9CZSgxKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2VzLnJlc291cmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGNvbnN0IGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlcy5yZXNvdXJjZXMuY2hhbmdlcy5CdWNrZXRSZXNvdXJjZTtcbiAgZXhwZWN0KGRpZmZlcmVuY2UpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gIGV4cGVjdChkaWZmZXJlbmNlPy5vbGRSZXNvdXJjZVR5cGUpLnRvRXF1YWwoJ0FXUzo6UzM6OkJ1Y2tldCcpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8ucHJvcGVydHlVcGRhdGVzKS50b0VxdWFsKHtcbiAgICBCdWNrZXROYW1lOiB7IG9sZFZhbHVlOiBidWNrZXROYW1lLCBuZXdWYWx1ZTogdW5kZWZpbmVkLCBjaGFuZ2VJbXBhY3Q6IFJlc291cmNlSW1wYWN0LldJTExfUkVQTEFDRSwgaXNEaWZmZXJlbnQ6IHRydWUgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnd2hlbiBhIHByb3BlcnR5IGlzIGFkZGVkJywgKCkgPT4ge1xuICBjb25zdCBidWNrZXROYW1lID0gJ1NoaW5leUJ1Y2tldE5hbWUnO1xuICBjb25zdCBjdXJyZW50VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBRdWV1ZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlNRUzo6UXVldWUnLFxuICAgICAgfSxcbiAgICAgIEJ1Y2tldFJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IG5ld1RlbXBsYXRlID0ge1xuICAgIFJlc291cmNlczoge1xuICAgICAgUXVldWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTUVM6OlF1ZXVlJyxcbiAgICAgIH0sXG4gICAgICBCdWNrZXRSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIEJ1Y2tldE5hbWU6IGJ1Y2tldE5hbWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmVGVtcGxhdGUoY3VycmVudFRlbXBsYXRlLCBuZXdUZW1wbGF0ZSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5kaWZmZXJlbmNlQ291bnQpLnRvQmUoMSk7XG4gIGV4cGVjdChkaWZmZXJlbmNlcy5yZXNvdXJjZXMuZGlmZmVyZW5jZUNvdW50KS50b0JlKDEpO1xuICBjb25zdCBkaWZmZXJlbmNlID0gZGlmZmVyZW5jZXMucmVzb3VyY2VzLmNoYW5nZXMuQnVja2V0UmVzb3VyY2U7XG4gIGV4cGVjdChkaWZmZXJlbmNlKS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8ub2xkUmVzb3VyY2VUeXBlKS50b0VxdWFsKCdBV1M6OlMzOjpCdWNrZXQnKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/LnByb3BlcnR5VXBkYXRlcykudG9FcXVhbCh7XG4gICAgQnVja2V0TmFtZTogeyBvbGRWYWx1ZTogdW5kZWZpbmVkLCBuZXdWYWx1ZTogYnVja2V0TmFtZSwgY2hhbmdlSW1wYWN0OiBSZXNvdXJjZUltcGFjdC5XSUxMX1JFUExBQ0UsIGlzRGlmZmVyZW50OiB0cnVlIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3doZW4gYSByZXNvdXJjZSB0eXBlIGNoYW5nZWQnLCAoKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIEJ1Y2tldFJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OklBTTo6UG9saWN5JyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIFBvbGljeU5hbWU6ICdQb2xpY3lOYW1lJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBuZXdUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIEJ1Y2tldFJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlMzOjpCdWNrZXQnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgQnVja2V0TmFtZTogJ0J1Y2tldE5hbWUnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IGRpZmZlcmVuY2VzID0gZGlmZlRlbXBsYXRlKGN1cnJlbnRUZW1wbGF0ZSwgbmV3VGVtcGxhdGUpO1xuICBleHBlY3QoZGlmZmVyZW5jZXMuZGlmZmVyZW5jZUNvdW50KS50b0JlKDEpO1xuICBleHBlY3QoZGlmZmVyZW5jZXMucmVzb3VyY2VzLmRpZmZlcmVuY2VDb3VudCkudG9CZSgxKTtcbiAgY29uc3QgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2VzLnJlc291cmNlcy5jaGFuZ2VzLkJ1Y2tldFJlc291cmNlO1xuICBleHBlY3QoZGlmZmVyZW5jZSkubm90LnRvQmUodW5kZWZpbmVkKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/Lm9sZFJlc291cmNlVHlwZSkudG9FcXVhbCgnQVdTOjpJQU06OlBvbGljeScpO1xuICBleHBlY3QoZGlmZmVyZW5jZT8ubmV3UmVzb3VyY2VUeXBlKS50b0VxdWFsKCdBV1M6OlMzOjpCdWNrZXQnKTtcbiAgZXhwZWN0KGRpZmZlcmVuY2U/LmNoYW5nZUltcGFjdCkudG9CZShSZXNvdXJjZUltcGFjdC5XSUxMX1JFUExBQ0UpO1xufSk7XG5cbnRlc3QoJ3Jlc291cmNlIHJlcGxhY2VtZW50IGlzIHRyYWNrZWQgdGhyb3VnaCByZWZlcmVuY2VzJywgKCkgPT4ge1xuICAvLyBJZiBhIHJlc291cmNlIGlzIHJlcGxhY2VkLCB0aGVuIHRoYXQgY2hhbmdlIHNob3dzIHRoYXQgcmVmZXJlbmNlcyBhcmVcbiAgLy8gZ29pbmcgdG8gY2hhbmdlLiBUaGlzIG1heSBsZWFkIHRvIHJlcGxhY2VtZW50IG9mIGRvd25zdHJlYW0gcmVzb3VyY2VzXG4gIC8vIGlmIHRoZSByZWZlcmVuY2UgaXMgdXNlZCBpbiBhbiBpbW11dGFibGUgcHJvcGVydHksIGFuZCBzbyBvbi5cblxuICAvLyBHSVZFTlxuICBjb25zdCBjdXJyZW50VGVtcGxhdGUgPSB7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBCdWNrZXQ6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6UzM6OkJ1Y2tldCcsXG4gICAgICAgIFByb3BlcnRpZXM6IHsgQnVja2V0TmFtZTogJ05hbWUxJyB9LCAvLyBJbW11dGFibGUgcHJvcFxuICAgICAgfSxcbiAgICAgIFF1ZXVlOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlNRUzo6UXVldWUnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7IFF1ZXVlTmFtZTogeyBSZWY6ICdCdWNrZXQnIH19LCAvLyBJbW11dGFibGUgcHJvcFxuICAgICAgfSxcbiAgICAgIFRvcGljOiB7XG4gICAgICAgIFR5cGU6ICdBV1M6OlNOUzo6VG9waWMnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7IFRvcGljTmFtZTogeyBSZWY6ICdRdWV1ZScgfX0sIC8vIEltbXV0YWJsZSBwcm9wXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG5cbiAgLy8gV0hFTlxuICBjb25zdCBuZXdUZW1wbGF0ZSA9IHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIEJ1Y2tldDoge1xuICAgICAgICBUeXBlOiAnQVdTOjpTMzo6QnVja2V0JyxcbiAgICAgICAgUHJvcGVydGllczogeyBCdWNrZXROYW1lOiAnTmFtZTInIH0sXG4gICAgICB9LFxuICAgICAgUXVldWU6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6U1FTOjpRdWV1ZScsXG4gICAgICAgIFByb3BlcnRpZXM6IHsgUXVldWVOYW1lOiB7IFJlZjogJ0J1Y2tldCcgfX0sXG4gICAgICB9LFxuICAgICAgVG9waWM6IHtcbiAgICAgICAgVHlwZTogJ0FXUzo6U05TOjpUb3BpYycsXG4gICAgICAgIFByb3BlcnRpZXM6IHsgVG9waWNOYW1lOiB7IFJlZjogJ1F1ZXVlJyB9fSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmVGVtcGxhdGUoY3VycmVudFRlbXBsYXRlLCBuZXdUZW1wbGF0ZSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoZGlmZmVyZW5jZXMucmVzb3VyY2VzLmRpZmZlcmVuY2VDb3VudCkudG9CZSgzKTtcbn0pO1xuIl19