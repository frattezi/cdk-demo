"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../../lib");
const util_1 = require("../util");
test('shows new AssumeRolePolicyDocument', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        MyRole: util_1.role({
            AssumeRolePolicyDocument: util_1.poldoc({
                Action: 'sts:AssumeRole',
                Effect: 'Allow',
                Principal: { Service: 'lambda.amazonaws.com' },
            }),
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementAdditions: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyRole.Arn}'] },
                principals: { not: false, values: ['Service:lambda.amazonaws.com'] },
                actions: { not: false, values: ['sts:AssumeRole'] },
            },
        ],
    });
});
test('implicitly knows principal of identity policy for all resource types', () => {
    for (const attr of ['Roles', 'Users', 'Groups']) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            MyPolicy: util_1.policy({
                [attr]: [{ Ref: 'MyRole' }],
                PolicyDocument: util_1.poldoc({
                    Effect: 'Allow',
                    Action: 's3:DoThatThing',
                    Resource: '*',
                }),
            }),
        }));
        // THEN
        expect(diff.iamChanges.toJson()).toEqual({
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['*'] },
                    principals: { not: false, values: ['AWS:${MyRole}'] },
                    actions: { not: false, values: ['s3:DoThatThing'] },
                },
            ],
        });
    }
});
test('policies on an identity object', () => {
    for (const resourceType of ['Role', 'User', 'Group']) {
        // WHEN
        const diff = lib_1.diffTemplate({}, util_1.template({
            MyIdentity: util_1.resource(`AWS::IAM::${resourceType}`, {
                Policies: [
                    {
                        PolicyName: 'Polly',
                        PolicyDocument: util_1.poldoc({
                            Effect: 'Allow',
                            Action: 's3:DoThatThing',
                            Resource: '*',
                        }),
                    },
                ],
            }),
        }));
        // THEN
        expect(diff.iamChanges.toJson()).toEqual({
            statementAdditions: [
                {
                    effect: 'Allow',
                    resources: { not: false, values: ['*'] },
                    principals: { not: false, values: ['AWS:${MyIdentity}'] },
                    actions: { not: false, values: ['s3:DoThatThing'] },
                },
            ],
        });
    }
});
test('if policy is attached to multiple roles all are shown', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        MyPolicy: util_1.policy({
            Roles: [{ Ref: 'MyRole' }, { Ref: 'ThyRole' }],
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 's3:DoThatThing',
                Resource: '*',
            }),
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementAdditions: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['*'] },
                principals: { not: false, values: ['AWS:${MyRole}'] },
                actions: { not: false, values: ['s3:DoThatThing'] },
            },
            {
                effect: 'Allow',
                resources: { not: false, values: ['*'] },
                principals: { not: false, values: ['AWS:${ThyRole}'] },
                actions: { not: false, values: ['s3:DoThatThing'] },
            },
        ],
    });
});
test('correctly parses Lambda permissions', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        MyPermission: util_1.resource('AWS::Lambda::Permission', {
            Action: 'lambda:InvokeFunction',
            FunctionName: { Ref: 'MyFunction' },
            Principal: 's3.amazonaws.com',
            SourceAccount: { Ref: 'AWS::AccountId' },
            SourceArn: { 'Fn::GetAtt': ['MyBucketF68F3FF0', 'Arn'] },
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementAdditions: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyFunction}'] },
                principals: { not: false, values: ['Service:s3.amazonaws.com'] },
                actions: { not: false, values: ['lambda:InvokeFunction'] },
                condition: {
                    StringEquals: { 'AWS:SourceAccount': '${AWS::AccountId}' },
                    ArnLike: { 'AWS:SourceArn': '${MyBucketF68F3FF0.Arn}' },
                },
            },
        ],
    });
});
test('implicitly knows resource of (queue) resource policy even if * given', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
            Queues: [{ Ref: 'MyQueue' }],
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 'sqs:SendMessage',
                Resource: '*',
                Principal: { Service: 'sns.amazonaws.com' },
            }),
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementAdditions: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyQueue}'] },
                principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                actions: { not: false, values: ['sqs:SendMessage'] },
            },
        ],
    });
});
test('finds sole statement removals', () => {
    // WHEN
    const diff = lib_1.diffTemplate(util_1.template({
        BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
            Bucket: { Ref: 'MyBucket' },
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 's3:PutObject',
                Resource: '*',
                Principal: { AWS: 'me' },
            }),
        }),
    }), {});
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementRemovals: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyBucket}'] },
                principals: { not: false, values: ['AWS:me'] },
                actions: { not: false, values: ['s3:PutObject'] },
            },
        ],
    });
});
test('finds one of many statement removals', () => {
    // WHEN
    const diff = lib_1.diffTemplate(util_1.template({
        BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
            Bucket: { Ref: 'MyBucket' },
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 's3:PutObject',
                Resource: '*',
                Principal: { AWS: 'me' },
            }, {
                Effect: 'Allow',
                Action: 's3:LookAtObject',
                Resource: '*',
                Principal: { AWS: 'me' },
            }),
        }),
    }), util_1.template({
        BucketPolicy: util_1.resource('AWS::S3::BucketPolicy', {
            Bucket: { Ref: 'MyBucket' },
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 's3:LookAtObject',
                Resource: '*',
                Principal: { AWS: 'me' },
            }),
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementRemovals: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyBucket}'] },
                principals: { not: false, values: ['AWS:me'] },
                actions: { not: false, values: ['s3:PutObject'] },
            },
        ],
    });
});
test('finds policy attachments', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        SomeRole: util_1.resource('AWS::IAM::Role', {
            ManagedPolicyArns: ['arn:policy'],
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        managedPolicyAdditions: [
            {
                identityArn: '${SomeRole}',
                managedPolicyArn: 'arn:policy',
            },
        ],
    });
});
test('finds policy removals', () => {
    // WHEN
    const diff = lib_1.diffTemplate(util_1.template({
        SomeRole: util_1.resource('AWS::IAM::Role', {
            ManagedPolicyArns: ['arn:policy', 'arn:policy2'],
        }),
    }), util_1.template({
        SomeRole: util_1.resource('AWS::IAM::Role', {
            ManagedPolicyArns: ['arn:policy2'],
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        managedPolicyRemovals: [
            {
                identityArn: '${SomeRole}',
                managedPolicyArn: 'arn:policy',
            },
        ],
    });
});
test('queuepolicy queue change counts as removal+addition', () => {
    // WHEN
    const diff = lib_1.diffTemplate(util_1.template({
        QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
            Queues: [{ Ref: 'MyQueue1' }],
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 'sqs:SendMessage',
                Resource: '*',
                Principal: { Service: 'sns.amazonaws.com' },
            }),
        }),
    }), util_1.template({
        QueuePolicy: util_1.resource('AWS::SQS::QueuePolicy', {
            Queues: [{ Ref: 'MyQueue2' }],
            PolicyDocument: util_1.poldoc({
                Effect: 'Allow',
                Action: 'sqs:SendMessage',
                Resource: '*',
                Principal: { Service: 'sns.amazonaws.com' },
            }),
        }),
    }));
    // THEN
    expect(diff.iamChanges.toJson()).toEqual({
        statementAdditions: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyQueue2}'] },
                principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                actions: { not: false, values: ['sqs:SendMessage'] },
            },
        ],
        statementRemovals: [
            {
                effect: 'Allow',
                resources: { not: false, values: ['${MyQueue1}'] },
                principals: { not: false, values: ['Service:sns.amazonaws.com'] },
                actions: { not: false, values: ['sqs:SendMessage'] },
            },
        ],
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0ZWN0LWNoYW5nZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRldGVjdC1jaGFuZ2VzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBeUM7QUFDekMsa0NBQW1FO0FBRW5FLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7SUFDOUMsT0FBTztJQUNQLE1BQU0sSUFBSSxHQUFHLGtCQUFZLENBQUMsRUFBRSxFQUFFLGVBQVEsQ0FBQztRQUNyQyxNQUFNLEVBQUUsV0FBSSxDQUFDO1lBQ1gsd0JBQXdCLEVBQUUsYUFBTSxDQUFDO2dCQUMvQixNQUFNLEVBQUUsZ0JBQWdCO2dCQUN4QixNQUFNLEVBQUUsT0FBTztnQkFDZixTQUFTLEVBQUUsRUFBRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUU7YUFDL0MsQ0FBQztTQUNILENBQUM7S0FDSCxDQUFDLENBQUMsQ0FBQztJQUVKLE9BQU87SUFDUCxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUN2QyxrQkFBa0IsRUFBRTtZQUNsQjtnQkFDRSxNQUFNLEVBQUUsT0FBTztnQkFDZixTQUFTLEVBQUUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFFLGVBQWUsQ0FBRSxFQUFFO2dCQUN0RCxVQUFVLEVBQUUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFFLDhCQUE4QixDQUFFLEVBQUU7Z0JBQ3RFLE9BQU8sRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUUsZ0JBQWdCLENBQUUsRUFBRTthQUN0RDtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsc0VBQXNFLEVBQUUsR0FBRyxFQUFFO0lBQ2hGLEtBQUssTUFBTSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxF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ZmZUZW1wbGF0ZSB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBwb2xkb2MsIHBvbGljeSwgcmVzb3VyY2UsIHJvbGUsIHRlbXBsYXRlIH0gZnJvbSAnLi4vdXRpbCc7XG5cbnRlc3QoJ3Nob3dzIG5ldyBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgZGlmZiA9IGRpZmZUZW1wbGF0ZSh7fSwgdGVtcGxhdGUoe1xuICAgIE15Um9sZTogcm9sZSh7XG4gICAgICBBc3N1bWVSb2xlUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgIEFjdGlvbjogJ3N0czpBc3N1bWVSb2xlJyxcbiAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ2xhbWJkYS5hbWF6b25hd3MuY29tJyB9LFxuICAgICAgfSksXG4gICAgfSksXG4gIH0pKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCkpLnRvRXF1YWwoe1xuICAgIHN0YXRlbWVudEFkZGl0aW9uczogW1xuICAgICAge1xuICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgIHJlc291cmNlczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJyR7TXlSb2xlLkFybn0nIF0gfSxcbiAgICAgICAgcHJpbmNpcGFsczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ1NlcnZpY2U6bGFtYmRhLmFtYXpvbmF3cy5jb20nIF0gfSxcbiAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3N0czpBc3N1bWVSb2xlJyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ltcGxpY2l0bHkga25vd3MgcHJpbmNpcGFsIG9mIGlkZW50aXR5IHBvbGljeSBmb3IgYWxsIHJlc291cmNlIHR5cGVzJywgKCkgPT4ge1xuICBmb3IgKGNvbnN0IGF0dHIgb2YgWydSb2xlcycsICdVc2VycycsICdHcm91cHMnXSkge1xuICAgIC8vIFdIRU5cbiAgICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgICBNeVBvbGljeTogcG9saWN5KHtcbiAgICAgICAgW2F0dHJdOiBbeyBSZWY6ICdNeVJvbGUnIH1dLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgQWN0aW9uOiAnczM6RG9UaGF0VGhpbmcnLFxuICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCkpLnRvRXF1YWwoe1xuICAgICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6JHtNeVJvbGV9JyBdIH0sXG4gICAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3MzOkRvVGhhdFRoaW5nJyBdIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9XG59KTtcblxudGVzdCgncG9saWNpZXMgb24gYW4gaWRlbnRpdHkgb2JqZWN0JywgKCkgPT4ge1xuICBmb3IgKGNvbnN0IHJlc291cmNlVHlwZSBvZiBbJ1JvbGUnLCAnVXNlcicsICdHcm91cCddKSB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICAgIE15SWRlbnRpdHk6IHJlc291cmNlKGBBV1M6OklBTTo6JHtyZXNvdXJjZVR5cGV9YCwge1xuICAgICAgICBQb2xpY2llczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIFBvbGljeU5hbWU6ICdQb2xseScsXG4gICAgICAgICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBBY3Rpb246ICdzMzpEb1RoYXRUaGluZycsXG4gICAgICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSksXG4gICAgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCkpLnRvRXF1YWwoe1xuICAgICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBlZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdBV1M6JHtNeUlkZW50aXR5fScgXSB9LFxuICAgICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzMzpEb1RoYXRUaGluZycgXSB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbnRlc3QoJ2lmIHBvbGljeSBpcyBhdHRhY2hlZCB0byBtdWx0aXBsZSByb2xlcyBhbGwgYXJlIHNob3duJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICBNeVBvbGljeTogcG9saWN5KHtcbiAgICAgIFJvbGVzOiBbeyBSZWY6ICdNeVJvbGUnIH0sIHsgUmVmOiAnVGh5Um9sZScgfV0sXG4gICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICBBY3Rpb246ICdzMzpEb1RoYXRUaGluZycsXG4gICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICB9KSxcbiAgICB9KSxcbiAgfSkpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnQVdTOiR7TXlSb2xlfScgXSB9LFxuICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnczM6RG9UaGF0VGhpbmcnIF0gfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnKicgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnQVdTOiR7VGh5Um9sZX0nIF0gfSxcbiAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ3MzOkRvVGhhdFRoaW5nJyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2NvcnJlY3RseSBwYXJzZXMgTGFtYmRhIHBlcm1pc3Npb25zJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICBNeVBlcm1pc3Npb246IHJlc291cmNlKCdBV1M6OkxhbWJkYTo6UGVybWlzc2lvbicsIHtcbiAgICAgIEFjdGlvbjogJ2xhbWJkYTpJbnZva2VGdW5jdGlvbicsXG4gICAgICBGdW5jdGlvbk5hbWU6IHsgUmVmOiAnTXlGdW5jdGlvbicgfSxcbiAgICAgIFByaW5jaXBhbDogJ3MzLmFtYXpvbmF3cy5jb20nLFxuICAgICAgU291cmNlQWNjb3VudDoge1JlZjogJ0FXUzo6QWNjb3VudElkJyB9LFxuICAgICAgU291cmNlQXJuOiB7J0ZuOjpHZXRBdHQnOiBbJ015QnVja2V0RjY4RjNGRjAnLCAnQXJuJ119LFxuICAgIH0pLFxuICB9KSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoZGlmZi5pYW1DaGFuZ2VzLnRvSnNvbigpKS50b0VxdWFsKHtcbiAgICBzdGF0ZW1lbnRBZGRpdGlvbnM6IFtcbiAgICAgIHtcbiAgICAgICAgZWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015RnVuY3Rpb259JyBdIH0sXG4gICAgICAgIHByaW5jaXBhbHM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdTZXJ2aWNlOnMzLmFtYXpvbmF3cy5jb20nIF0gfSxcbiAgICAgICAgYWN0aW9uczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ2xhbWJkYTpJbnZva2VGdW5jdGlvbicgXSB9LFxuICAgICAgICBjb25kaXRpb246IHtcbiAgICAgICAgICBTdHJpbmdFcXVhbHM6IHsgJ0FXUzpTb3VyY2VBY2NvdW50JzogJyR7QVdTOjpBY2NvdW50SWR9JyB9LFxuICAgICAgICAgIEFybkxpa2U6IHsgJ0FXUzpTb3VyY2VBcm4nOiAnJHtNeUJ1Y2tldEY2OEYzRkYwLkFybn0nIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ltcGxpY2l0bHkga25vd3MgcmVzb3VyY2Ugb2YgKHF1ZXVlKSByZXNvdXJjZSBwb2xpY3kgZXZlbiBpZiAqIGdpdmVuJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgIFF1ZXVlczogWyB7IFJlZjogJ015UXVldWUnIH0gXSxcbiAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgIEFjdGlvbjogJ3NxczpTZW5kTWVzc2FnZScsXG4gICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgIFByaW5jaXBhbDogeyBTZXJ2aWNlOiAnc25zLmFtYXpvbmF3cy5jb20nIH0sXG4gICAgICB9KSxcbiAgICB9KSxcbiAgfSkpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgc3RhdGVtZW50QWRkaXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeVF1ZXVlfScgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpzbnMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnc3FzOlNlbmRNZXNzYWdlJyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ZpbmRzIHNvbGUgc3RhdGVtZW50IHJlbW92YWxzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUodGVtcGxhdGUoe1xuICAgIEJ1Y2tldFBvbGljeTogcmVzb3VyY2UoJ0FXUzo6UzM6OkJ1Y2tldFBvbGljeScsIHtcbiAgICAgIEJ1Y2tldDogeyBSZWY6ICdNeUJ1Y2tldCcgfSxcbiAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgIEFjdGlvbjogJ3MzOlB1dE9iamVjdCcsXG4gICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgIFByaW5jaXBhbDogeyBBV1M6ICdtZScgfSxcbiAgICAgIH0pLFxuICAgIH0pLFxuICB9KSwge30pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgc3RhdGVtZW50UmVtb3ZhbHM6IFtcbiAgICAgIHtcbiAgICAgICAgZWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015QnVja2V0fScgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnQVdTOm1lJyBdIH0sXG4gICAgICAgIGFjdGlvbnM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICdzMzpQdXRPYmplY3QnIF0gfSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG59KTtcblxudGVzdCgnZmluZHMgb25lIG9mIG1hbnkgc3RhdGVtZW50IHJlbW92YWxzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoXG4gICAgdGVtcGxhdGUoe1xuICAgICAgQnVja2V0UG9saWN5OiByZXNvdXJjZSgnQVdTOjpTMzo6QnVja2V0UG9saWN5Jywge1xuICAgICAgICBCdWNrZXQ6IHsgUmVmOiAnTXlCdWNrZXQnIH0sXG4gICAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICBBY3Rpb246ICdzMzpQdXRPYmplY3QnLFxuICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgUHJpbmNpcGFsOiB7IEFXUzogJ21lJyB9LFxuICAgICAgICB9LCB7XG4gICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgIEFjdGlvbjogJ3MzOkxvb2tBdE9iamVjdCcsXG4gICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICBQcmluY2lwYWw6IHsgQVdTOiAnbWUnIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgfSksXG4gICAgdGVtcGxhdGUoe1xuICAgICAgQnVja2V0UG9saWN5OiByZXNvdXJjZSgnQVdTOjpTMzo6QnVja2V0UG9saWN5Jywge1xuICAgICAgICBCdWNrZXQ6IHsgUmVmOiAnTXlCdWNrZXQnIH0sXG4gICAgICAgIFBvbGljeURvY3VtZW50OiBwb2xkb2Moe1xuICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICBBY3Rpb246ICdzMzpMb29rQXRPYmplY3QnLFxuICAgICAgICAgIFJlc291cmNlOiAnKicsXG4gICAgICAgICAgUHJpbmNpcGFsOiB7IEFXUzogJ21lJyB9LFxuICAgICAgICB9KSxcbiAgICAgIH0pLFxuICAgIH0pKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChkaWZmLmlhbUNoYW5nZXMudG9Kc29uKCkpLnRvRXF1YWwoe1xuICAgIHN0YXRlbWVudFJlbW92YWxzOiBbXG4gICAgICB7XG4gICAgICAgIGVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgcmVzb3VyY2VzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnJHtNeUJ1Y2tldH0nIF0gfSxcbiAgICAgICAgcHJpbmNpcGFsczogeyBub3Q6IGZhbHNlLCB2YWx1ZXM6IFsgJ0FXUzptZScgXSB9LFxuICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnczM6UHV0T2JqZWN0JyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2ZpbmRzIHBvbGljeSBhdHRhY2htZW50cycsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHt9LCB0ZW1wbGF0ZSh7XG4gICAgU29tZVJvbGU6IHJlc291cmNlKCdBV1M6OklBTTo6Um9sZScsIHtcbiAgICAgIE1hbmFnZWRQb2xpY3lBcm5zOiBbJ2Fybjpwb2xpY3knXSxcbiAgICB9KSxcbiAgfSkpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgbWFuYWdlZFBvbGljeUFkZGl0aW9uczogW1xuICAgICAge1xuICAgICAgICBpZGVudGl0eUFybjogJyR7U29tZVJvbGV9JyxcbiAgICAgICAgbWFuYWdlZFBvbGljeUFybjogJ2Fybjpwb2xpY3knLFxuICAgICAgfSxcbiAgICBdLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdmaW5kcyBwb2xpY3kgcmVtb3ZhbHMnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgZGlmZiA9IGRpZmZUZW1wbGF0ZShcbiAgICB0ZW1wbGF0ZSh7XG4gICAgICBTb21lUm9sZTogcmVzb3VyY2UoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgICAgICBNYW5hZ2VkUG9saWN5QXJuczogWydhcm46cG9saWN5JywgJ2Fybjpwb2xpY3kyJ10sXG4gICAgICB9KSxcbiAgICB9KSxcbiAgICB0ZW1wbGF0ZSh7XG4gICAgICBTb21lUm9sZTogcmVzb3VyY2UoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgICAgICBNYW5hZ2VkUG9saWN5QXJuczogWydhcm46cG9saWN5MiddLFxuICAgICAgfSksXG4gICAgfSkpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGRpZmYuaWFtQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgbWFuYWdlZFBvbGljeVJlbW92YWxzOiBbXG4gICAgICB7XG4gICAgICAgIGlkZW50aXR5QXJuOiAnJHtTb21lUm9sZX0nLFxuICAgICAgICBtYW5hZ2VkUG9saWN5QXJuOiAnYXJuOnBvbGljeScsXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3F1ZXVlcG9saWN5IHF1ZXVlIGNoYW5nZSBjb3VudHMgYXMgcmVtb3ZhbCthZGRpdGlvbicsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBkaWZmID0gZGlmZlRlbXBsYXRlKHRlbXBsYXRlKHtcbiAgICBRdWV1ZVBvbGljeTogcmVzb3VyY2UoJ0FXUzo6U1FTOjpRdWV1ZVBvbGljeScsIHtcbiAgICAgIFF1ZXVlczogWyB7IFJlZjogJ015UXVldWUxJyB9IF0sXG4gICAgICBQb2xpY3lEb2N1bWVudDogcG9sZG9jKHtcbiAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICBBY3Rpb246ICdzcXM6U2VuZE1lc3NhZ2UnLFxuICAgICAgICBSZXNvdXJjZTogJyonLFxuICAgICAgICBQcmluY2lwYWw6IHsgU2VydmljZTogJ3Nucy5hbWF6b25hd3MuY29tJyB9LFxuICAgICAgfSksXG4gICAgfSksXG4gIH0pLCB0ZW1wbGF0ZSh7XG4gICAgUXVldWVQb2xpY3k6IHJlc291cmNlKCdBV1M6OlNRUzo6UXVldWVQb2xpY3knLCB7XG4gICAgICBRdWV1ZXM6IFsgeyBSZWY6ICdNeVF1ZXVlMicgfSBdLFxuICAgICAgUG9saWN5RG9jdW1lbnQ6IHBvbGRvYyh7XG4gICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgQWN0aW9uOiAnc3FzOlNlbmRNZXNzYWdlJyxcbiAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgUHJpbmNpcGFsOiB7IFNlcnZpY2U6ICdzbnMuYW1hem9uYXdzLmNvbScgfSxcbiAgICAgIH0pLFxuICAgIH0pLFxuICB9KSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoZGlmZi5pYW1DaGFuZ2VzLnRvSnNvbigpKS50b0VxdWFsKHtcbiAgICBzdGF0ZW1lbnRBZGRpdGlvbnM6IFtcbiAgICAgIHtcbiAgICAgICAgZWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015UXVldWUyfScgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpzbnMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnc3FzOlNlbmRNZXNzYWdlJyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gICAgc3RhdGVtZW50UmVtb3ZhbHM6IFtcbiAgICAgIHtcbiAgICAgICAgZWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICByZXNvdXJjZXM6IHsgbm90OiBmYWxzZSwgdmFsdWVzOiBbICcke015UXVldWUxfScgXSB9LFxuICAgICAgICBwcmluY2lwYWxzOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnU2VydmljZTpzbnMuYW1hem9uYXdzLmNvbScgXSB9LFxuICAgICAgICBhY3Rpb25zOiB7IG5vdDogZmFsc2UsIHZhbHVlczogWyAnc3FzOlNlbmRNZXNzYWdlJyBdIH0sXG4gICAgICB9LFxuICAgIF0sXG4gIH0pO1xufSk7XG4iXX0=