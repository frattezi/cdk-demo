"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../../lib");
const util_1 = require("../util");
test('detect addition of all types of rules', () => {
    // WHEN
    const diff = lib_1.diffTemplate({}, util_1.template({
        SG: util_1.resource('AWS::EC2::SecurityGroup', {
            SecurityGroupIngress: [
                {
                    CidrIp: '1.2.3.4/8',
                    FromPort: 80,
                    ToPort: 80,
                    IpProtocol: 'tcp',
                },
            ],
            SecurityGroupEgress: [
                {
                    DestinationSecurityGroupId: { 'Fn::GetAtt': ['ThatOtherGroup', 'GroupId'] },
                    FromPort: 80,
                    ToPort: 80,
                    IpProtocol: 'tcp',
                },
            ],
        }),
        InRule: util_1.resource('AWS::EC2::SecurityGroupIngress', {
            GroupId: { 'Fn::GetAtt': ['SG', 'GroupId'] },
            FromPort: -1,
            ToPort: -1,
            IpProtocol: 'icmp',
            SourcePrefixListId: 'pl-1234',
        }),
        OutRule: util_1.resource('AWS::EC2::SecurityGroupEgress', {
            GroupId: { 'Fn::GetAtt': ['SG', 'GroupId'] },
            FromPort: -1,
            ToPort: -1,
            IpProtocol: 'udp',
            CidrIp: '7.8.9.0/24',
        }),
    }));
    // THEN
    expect(diff.securityGroupChanges.toJson()).toEqual({
        ingressRuleAdditions: [
            {
                groupId: '${SG.GroupId}',
                ipProtocol: 'tcp',
                fromPort: 80,
                toPort: 80,
                peer: { kind: 'cidr-ip', ip: '1.2.3.4/8' },
            },
            {
                groupId: '${SG.GroupId}',
                ipProtocol: 'icmp',
                fromPort: -1,
                toPort: -1,
                peer: { kind: 'prefix-list', prefixListId: 'pl-1234' },
            },
        ],
        egressRuleAdditions: [
            {
                groupId: '${SG.GroupId}',
                ipProtocol: 'tcp',
                fromPort: 80,
                toPort: 80,
                peer: { kind: 'security-group', securityGroupId: '${ThatOtherGroup.GroupId}' },
            },
            {
                groupId: '${SG.GroupId}',
                ipProtocol: 'udp',
                fromPort: -1,
                toPort: -1,
                peer: { kind: 'cidr-ip', ip: '7.8.9.0/24' },
            },
        ],
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0ZWN0LWNoYW5nZXMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRldGVjdC1jaGFuZ2VzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBeUM7QUFDekMsa0NBQTZDO0FBRTdDLElBQUksQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7SUFDakQsT0FBTztJQUNQLE1BQU0sSUFBSSxHQUFHLGtCQUFZLENBQUMsRUFBRSxFQUFFLGVBQVEsQ0FBQztRQUNyQyxFQUFFLEVBQUUsZUFBUSxDQUFDLHlCQUF5QixFQUFFO1lBQ3RDLG9CQUFvQixFQUFFO2dCQUNwQjtvQkFDRSxNQUFNLEVBQUUsV0FBVztvQkFDbkIsUUFBUSxFQUFFLEVBQUU7b0JBQ1osTUFBTSxFQUFFLEVBQUU7b0JBQ1YsVUFBVSxFQUFFLEtBQUs7aUJBQ2xCO2FBQ0Y7WUFDRCxtQkFBbUIsRUFBRTtnQkFDbkI7b0JBQ0UsMEJBQTBCLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRTtvQkFDM0UsUUFBUSxFQUFFLEVBQUU7b0JBQ1osTUFBTSxFQUFFLEVBQUU7b0JBQ1YsVUFBVSxFQUFFLEtBQUs7aUJBQ2xCO2FBQ0Y7U0FDRixDQUFDO1FBQ0YsTUFBTSxFQUFFLGVBQVEsQ0FBQyxnQ0FBZ0MsRUFBRTtZQUNqRCxPQUFPLEVBQUUsRUFBRSxZQUFZLEVBQUUsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLEVBQUU7WUFDNUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUNaLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDVixVQUFVLEVBQUUsTUFBTTtZQUNsQixrQkFBa0IsRUFBRSxTQUFTO1NBQzlCLENBQUM7UUFDRixPQUFPLEVBQUUsZUFBUSxDQUFDLCtCQUErQixFQUFFO1lBQ2pELE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsRUFBRTtZQUM1QyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ1osTUFBTSxFQUFFLENBQUMsQ0FBQztZQUNWLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLE1BQU0sRUFBRSxZQUFZO1NBQ3JCLENBQUM7S0FDSCxDQUFDLENBQUMsQ0FBQztJQUVKLE9BQU87SUFDUCxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ2pELG9CQUFvQixFQUFFO1lBQ3BCO2dCQUNFLE9BQU8sRUFBRSxlQUFlO2dCQUN4QixVQUFVLEVBQUUsS0FBSztnQkFDakIsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osTUFBTSxFQUFFLEVBQUU7Z0JBQ1YsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsV0FBVyxFQUFFO2FBQzNDO1lBQ0Q7Z0JBQ0UsT0FBTyxFQUFFLGVBQWU7Z0JBQ3hCLFVBQVUsRUFBRSxNQUFNO2dCQUNsQixRQUFRLEVBQUUsQ0FBQyxDQUFDO2dCQUNaLE1BQU0sRUFBRSxDQUFDLENBQUM7Z0JBQ1YsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFO2FBQ3ZEO1NBQ0Y7UUFDRCxtQkFBbUIsRUFBRTtZQUNuQjtnQkFDRSxPQUFPLEVBQUUsZUFBZTtnQkFDeEIsVUFBVSxFQUFFLEtBQUs7Z0JBQ2pCLFFBQVEsRUFBRSxFQUFFO2dCQUNaLE1BQU0sRUFBRSxFQUFFO2dCQUNWLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsMkJBQTJCLEVBQUU7YUFDL0U7WUFDRDtnQkFDRSxPQUFPLEVBQUUsZUFBZTtnQkFDeEIsVUFBVSxFQUFFLEtBQUs7Z0JBQ2pCLFFBQVEsRUFBRSxDQUFDLENBQUM7Z0JBQ1osTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDVixJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUU7YUFDNUM7U0FDRjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGlmZlRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IHJlc291cmNlLCB0ZW1wbGF0ZSB9IGZyb20gJy4uL3V0aWwnO1xuXG50ZXN0KCdkZXRlY3QgYWRkaXRpb24gb2YgYWxsIHR5cGVzIG9mIHJ1bGVzJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGRpZmYgPSBkaWZmVGVtcGxhdGUoe30sIHRlbXBsYXRlKHtcbiAgICBTRzogcmVzb3VyY2UoJ0FXUzo6RUMyOjpTZWN1cml0eUdyb3VwJywge1xuICAgICAgU2VjdXJpdHlHcm91cEluZ3Jlc3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIENpZHJJcDogJzEuMi4zLjQvOCcsXG4gICAgICAgICAgRnJvbVBvcnQ6IDgwLFxuICAgICAgICAgIFRvUG9ydDogODAsXG4gICAgICAgICAgSXBQcm90b2NvbDogJ3RjcCcsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgU2VjdXJpdHlHcm91cEVncmVzczogW1xuICAgICAgICB7XG4gICAgICAgICAgRGVzdGluYXRpb25TZWN1cml0eUdyb3VwSWQ6IHsgJ0ZuOjpHZXRBdHQnOiBbJ1RoYXRPdGhlckdyb3VwJywgJ0dyb3VwSWQnXSB9LFxuICAgICAgICAgIEZyb21Qb3J0OiA4MCxcbiAgICAgICAgICBUb1BvcnQ6IDgwLFxuICAgICAgICAgIElwUHJvdG9jb2w6ICd0Y3AnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KSxcbiAgICBJblJ1bGU6IHJlc291cmNlKCdBV1M6OkVDMjo6U2VjdXJpdHlHcm91cEluZ3Jlc3MnLCB7XG4gICAgICBHcm91cElkOiB7ICdGbjo6R2V0QXR0JzogWydTRycsICdHcm91cElkJ10gfSxcbiAgICAgIEZyb21Qb3J0OiAtMSxcbiAgICAgIFRvUG9ydDogLTEsXG4gICAgICBJcFByb3RvY29sOiAnaWNtcCcsXG4gICAgICBTb3VyY2VQcmVmaXhMaXN0SWQ6ICdwbC0xMjM0JyxcbiAgICB9KSxcbiAgICBPdXRSdWxlOiByZXNvdXJjZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXBFZ3Jlc3MnLCB7XG4gICAgICBHcm91cElkOiB7ICdGbjo6R2V0QXR0JzogWydTRycsICdHcm91cElkJ10gfSxcbiAgICAgIEZyb21Qb3J0OiAtMSxcbiAgICAgIFRvUG9ydDogLTEsXG4gICAgICBJcFByb3RvY29sOiAndWRwJyxcbiAgICAgIENpZHJJcDogJzcuOC45LjAvMjQnLFxuICAgIH0pLFxuICB9KSk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoZGlmZi5zZWN1cml0eUdyb3VwQ2hhbmdlcy50b0pzb24oKSkudG9FcXVhbCh7XG4gICAgaW5ncmVzc1J1bGVBZGRpdGlvbnM6IFtcbiAgICAgIHtcbiAgICAgICAgZ3JvdXBJZDogJyR7U0cuR3JvdXBJZH0nLFxuICAgICAgICBpcFByb3RvY29sOiAndGNwJyxcbiAgICAgICAgZnJvbVBvcnQ6IDgwLFxuICAgICAgICB0b1BvcnQ6IDgwLFxuICAgICAgICBwZWVyOiB7IGtpbmQ6ICdjaWRyLWlwJywgaXA6ICcxLjIuMy40LzgnIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBncm91cElkOiAnJHtTRy5Hcm91cElkfScsXG4gICAgICAgIGlwUHJvdG9jb2w6ICdpY21wJyxcbiAgICAgICAgZnJvbVBvcnQ6IC0xLFxuICAgICAgICB0b1BvcnQ6IC0xLFxuICAgICAgICBwZWVyOiB7IGtpbmQ6ICdwcmVmaXgtbGlzdCcsIHByZWZpeExpc3RJZDogJ3BsLTEyMzQnIH0sXG4gICAgICB9LFxuICAgIF0sXG4gICAgZWdyZXNzUnVsZUFkZGl0aW9uczogW1xuICAgICAge1xuICAgICAgICBncm91cElkOiAnJHtTRy5Hcm91cElkfScsXG4gICAgICAgIGlwUHJvdG9jb2w6ICd0Y3AnLFxuICAgICAgICBmcm9tUG9ydDogODAsXG4gICAgICAgIHRvUG9ydDogODAsXG4gICAgICAgIHBlZXI6IHsga2luZDogJ3NlY3VyaXR5LWdyb3VwJywgc2VjdXJpdHlHcm91cElkOiAnJHtUaGF0T3RoZXJHcm91cC5Hcm91cElkfScgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGdyb3VwSWQ6ICcke1NHLkdyb3VwSWR9JyxcbiAgICAgICAgaXBQcm90b2NvbDogJ3VkcCcsXG4gICAgICAgIGZyb21Qb3J0OiAtMSxcbiAgICAgICAgdG9Qb3J0OiAtMSxcbiAgICAgICAgcGVlcjogeyBraW5kOiAnY2lkci1pcCcsIGlwOiAnNy44LjkuMC8yNCcgfSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSk7XG59KTtcbiJdfQ==