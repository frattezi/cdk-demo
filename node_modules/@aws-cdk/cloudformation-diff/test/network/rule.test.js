"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fc = require("fast-check");
const security_group_rule_1 = require("../../lib/network/security-group-rule");
test('can parse cidr-ip', () => {
    const rule = new security_group_rule_1.SecurityGroupRule({
        GroupId: 'sg-1234',
        IpProtocol: 'tcp',
        FromPort: 10,
        ToPort: 20,
        CidrIp: '1.2.3.4/8',
    });
    expect(rule.groupId).toEqual('sg-1234');
    expect(rule.ipProtocol).toEqual('tcp');
    expect(rule.fromPort).toEqual(10);
    expect(rule.toPort).toEqual(20);
    const peer = rule.peer;
    if (peer.kind !== 'cidr-ip') {
        throw new Error('Fail');
    }
    expect(peer.ip).toEqual('1.2.3.4/8');
});
test('can parse cidr-ip 6', () => {
    const rule = new security_group_rule_1.SecurityGroupRule({
        CidrIpv6: '::/0',
    });
    const peer = rule.peer;
    if (peer.kind !== 'cidr-ip') {
        throw new Error('Fail');
    }
    expect(peer.ip).toEqual('::/0');
});
test('can parse securityGroup', () => {
    for (const key of ['DestinationSecurityGroupId', 'SourceSecurityGroupId']) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            [key]: 'sg-1234',
        });
        const peer = rule.peer;
        if (peer.kind !== 'security-group') {
            throw new Error('Fail');
        }
        expect(peer.securityGroupId).toEqual('sg-1234');
    }
});
test('can parse prefixlist', () => {
    for (const key of ['DestinationPrefixListId', 'SourcePrefixListId']) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            [key]: 'pl-1',
        });
        const peer = rule.peer;
        if (peer.kind !== 'prefix-list') {
            throw new Error('Fail');
        }
        expect(peer.prefixListId).toEqual('pl-1');
    }
});
test('equality is reflexive', () => {
    fc.assert(fc.property(arbitraryRule, (statement) => {
        return new security_group_rule_1.SecurityGroupRule(statement).equal(new security_group_rule_1.SecurityGroupRule(statement));
    }));
});
test('equality is symmetric', () => {
    fc.assert(fc.property(twoArbitraryRules, (s) => {
        const a = new security_group_rule_1.SecurityGroupRule(s.rule1);
        const b = new security_group_rule_1.SecurityGroupRule(s.rule2);
        fc.pre(a.equal(b));
        return b.equal(a);
    }));
});
const arbitraryRule = fc.record({
    IpProtocol: fc.constantFrom('tcp', 'udp', 'icmp'),
    FromPort: fc.integer(80, 81),
    ToPort: fc.integer(81, 82),
    CidrIp: fc.constantFrom('0.0.0.0/0', '1.2.3.4/8', undefined, undefined),
    DestinationSecurityGroupId: fc.constantFrom('sg-1234', undefined),
    DestinationPrefixListId: fc.constantFrom('pl-1', undefined),
});
const twoArbitraryRules = fc.record({
    rule1: arbitraryRule,
    rule2: arbitraryRule,
    copyIp: fc.boolean(),
    copyFromPort: fc.boolean(),
    copyToPort: fc.boolean(),
    copyCidrIp: fc.boolean(),
    copySecurityGroupId: fc.boolean(),
    copyPrefixListId: fc.boolean(),
}).map(op => {
    const original = op.rule1;
    const modified = Object.create(original, {});
    if (op.copyIp) {
        modified.IpProtocol = op.rule2.IpProtocol;
    }
    if (op.copyFromPort) {
        modified.FromPort = op.rule2.FromPort;
    }
    if (op.copyToPort) {
        modified.ToPort = op.rule2.ToPort;
    }
    if (op.copyCidrIp) {
        modified.CidrIp = op.rule2.CidrIp;
    }
    if (op.copySecurityGroupId) {
        modified.DestinationSecurityGroupId = op.rule2.DestinationSecurityGroupId;
    }
    if (op.copyPrefixListId) {
        modified.DestinationPrefixListId = op.rule2.DestinationPrefixListId;
    }
    return { rule1: original, rule2: modified };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVsZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicnVsZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQWlDO0FBQ2pDLCtFQUEwRTtBQUUxRSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQzdCLE1BQU0sSUFBSSxHQUFHLElBQUksdUNBQWlCLENBQUM7UUFDakMsT0FBTyxFQUFFLFNBQVM7UUFDbEIsVUFBVSxFQUFFLEtBQUs7UUFDakIsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsRUFBRTtRQUNWLE1BQU0sRUFBRSxXQUFXO0tBQ3BCLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRWhDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFLLENBQUM7SUFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7S0FBRTtJQUN6RCxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsTUFBTSxJQUFJLEdBQUcsSUFBSSx1Q0FBaUIsQ0FBQztRQUNqQyxRQUFRLEVBQUUsTUFBTTtLQUNq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RUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7S0FBRTtJQUMvRCxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUU7UUFBRSxRQUFRLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0tBQUU7SUFDekQsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFO1FBQUUsUUFBUSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztLQUFFO0lBQ3pELElBQUksRUFBRSxDQUFDLG1CQUFtQixFQUFFO1FBQUUsUUFBUSxDQUFDLDBCQUEwQixHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsMEJBQTBCLENBQUM7S0FBRTtJQUMxRyxJQUFJLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRTtRQUFFLFFBQVEsQ0FBQyx1QkFBdUIsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLHVCQUF1QixDQUFDO0tBQUU7SUFFakcsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDO0FBQzlDLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZmMgZnJvbSAnZmFzdC1jaGVjayc7XG5pbXBvcnQgeyBTZWN1cml0eUdyb3VwUnVsZSB9IGZyb20gJy4uLy4uL2xpYi9uZXR3b3JrL3NlY3VyaXR5LWdyb3VwLXJ1bGUnO1xuXG50ZXN0KCdjYW4gcGFyc2UgY2lkci1pcCcsICgpID0+IHtcbiAgY29uc3QgcnVsZSA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7XG4gICAgR3JvdXBJZDogJ3NnLTEyMzQnLFxuICAgIElwUHJvdG9jb2w6ICd0Y3AnLFxuICAgIEZyb21Qb3J0OiAxMCxcbiAgICBUb1BvcnQ6IDIwLFxuICAgIENpZHJJcDogJzEuMi4zLjQvOCcsXG4gIH0pO1xuXG4gIGV4cGVjdChydWxlLmdyb3VwSWQpLnRvRXF1YWwoJ3NnLTEyMzQnKTtcbiAgZXhwZWN0KHJ1bGUuaXBQcm90b2NvbCkudG9FcXVhbCgndGNwJyk7XG4gIGV4cGVjdChydWxlLmZyb21Qb3J0KS50b0VxdWFsKDEwKTtcbiAgZXhwZWN0KHJ1bGUudG9Qb3J0KS50b0VxdWFsKDIwKTtcblxuICBjb25zdCBwZWVyID0gcnVsZS5wZWVyITtcbiAgaWYgKHBlZXIua2luZCAhPT0gJ2NpZHItaXAnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gIGV4cGVjdChwZWVyLmlwKS50b0VxdWFsKCcxLjIuMy40LzgnKTtcbn0pO1xuXG50ZXN0KCdjYW4gcGFyc2UgY2lkci1pcCA2JywgKCkgPT4ge1xuICBjb25zdCBydWxlID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHtcbiAgICBDaWRySXB2NjogJzo6LzAnLFxuICB9KTtcblxuICBjb25zdCBwZWVyID0gcnVsZS5wZWVyITtcbiAgaWYgKHBlZXIua2luZCAhPT0gJ2NpZHItaXAnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gIGV4cGVjdChwZWVyLmlwKS50b0VxdWFsKCc6Oi8wJyk7XG59KTtcblxudGVzdCgnY2FuIHBhcnNlIHNlY3VyaXR5R3JvdXAnLCAoKSA9PiB7XG4gIGZvciAoY29uc3Qga2V5IG9mIFsnRGVzdGluYXRpb25TZWN1cml0eUdyb3VwSWQnLCAnU291cmNlU2VjdXJpdHlHcm91cElkJ10pIHtcbiAgICBjb25zdCBydWxlID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHtcbiAgICAgIFtrZXldOiAnc2ctMTIzNCcsXG4gICAgfSk7XG5cbiAgICBjb25zdCBwZWVyID0gcnVsZS5wZWVyITtcbiAgICBpZiAocGVlci5raW5kICE9PSAnc2VjdXJpdHktZ3JvdXAnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gICAgZXhwZWN0KHBlZXIuc2VjdXJpdHlHcm91cElkKS50b0VxdWFsKCdzZy0xMjM0Jyk7XG4gIH1cbn0pO1xuXG50ZXN0KCdjYW4gcGFyc2UgcHJlZml4bGlzdCcsICgpID0+IHtcbiAgZm9yIChjb25zdCBrZXkgb2YgWydEZXN0aW5hdGlvblByZWZpeExpc3RJZCcsICdTb3VyY2VQcmVmaXhMaXN0SWQnXSkge1xuICAgIGNvbnN0IHJ1bGUgPSBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoe1xuICAgICAgW2tleV06ICdwbC0xJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IHBlZXIgPSBydWxlLnBlZXIhO1xuICAgIGlmIChwZWVyLmtpbmQgIT09ICdwcmVmaXgtbGlzdCcpIHsgdGhyb3cgbmV3IEVycm9yKCdGYWlsJyk7IH1cbiAgICBleHBlY3QocGVlci5wcmVmaXhMaXN0SWQpLnRvRXF1YWwoJ3BsLTEnKTtcbiAgfVxufSk7XG5cbnRlc3QoJ2VxdWFsaXR5IGlzIHJlZmxleGl2ZScsICgpID0+IHtcbiAgZmMuYXNzZXJ0KGZjLnByb3BlcnR5KFxuICAgIGFyYml0cmFyeVJ1bGUsIChzdGF0ZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoc3RhdGVtZW50KS5lcXVhbChuZXcgU2VjdXJpdHlHcm91cFJ1bGUoc3RhdGVtZW50KSk7XG4gICAgfSxcbiAgKSk7XG59KTtcblxudGVzdCgnZXF1YWxpdHkgaXMgc3ltbWV0cmljJywgKCkgPT4ge1xuICBmYy5hc3NlcnQoZmMucHJvcGVydHkoXG4gICAgdHdvQXJiaXRyYXJ5UnVsZXMsIChzKSA9PiB7XG4gICAgICBjb25zdCBhID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHMucnVsZTEpO1xuICAgICAgY29uc3QgYiA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZShzLnJ1bGUyKTtcblxuICAgICAgZmMucHJlKGEuZXF1YWwoYikpO1xuICAgICAgcmV0dXJuIGIuZXF1YWwoYSk7XG4gICAgfSxcbiAgKSk7XG59KTtcblxuY29uc3QgYXJiaXRyYXJ5UnVsZSA9IGZjLnJlY29yZCh7XG4gIElwUHJvdG9jb2w6IGZjLmNvbnN0YW50RnJvbSgndGNwJywgJ3VkcCcsICdpY21wJyksXG4gIEZyb21Qb3J0OiBmYy5pbnRlZ2VyKDgwLCA4MSksXG4gIFRvUG9ydDogZmMuaW50ZWdlcig4MSwgODIpLFxuICBDaWRySXA6IGZjLmNvbnN0YW50RnJvbSgnMC4wLjAuMC8wJywgJzEuMi4zLjQvOCcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkKSxcbiAgRGVzdGluYXRpb25TZWN1cml0eUdyb3VwSWQ6IGZjLmNvbnN0YW50RnJvbSgnc2ctMTIzNCcsIHVuZGVmaW5lZCksXG4gIERlc3RpbmF0aW9uUHJlZml4TGlzdElkOiBmYy5jb25zdGFudEZyb20oJ3BsLTEnLCB1bmRlZmluZWQpLFxufSk7XG5cbmNvbnN0IHR3b0FyYml0cmFyeVJ1bGVzID0gZmMucmVjb3JkKHtcbiAgcnVsZTE6IGFyYml0cmFyeVJ1bGUsXG4gIHJ1bGUyOiBhcmJpdHJhcnlSdWxlLFxuICBjb3B5SXA6IGZjLmJvb2xlYW4oKSxcbiAgY29weUZyb21Qb3J0OiBmYy5ib29sZWFuKCksXG4gIGNvcHlUb1BvcnQgOiBmYy5ib29sZWFuKCksXG4gIGNvcHlDaWRySXA6IGZjLmJvb2xlYW4oKSxcbiAgY29weVNlY3VyaXR5R3JvdXBJZDogZmMuYm9vbGVhbigpLFxuICBjb3B5UHJlZml4TGlzdElkOiBmYy5ib29sZWFuKCksXG59KS5tYXAob3AgPT4ge1xuICBjb25zdCBvcmlnaW5hbCA9IG9wLnJ1bGUxO1xuICBjb25zdCBtb2RpZmllZCA9IE9iamVjdC5jcmVhdGUob3JpZ2luYWwsIHt9KTtcblxuICBpZiAob3AuY29weUlwKSB7IG1vZGlmaWVkLklwUHJvdG9jb2wgPSBvcC5ydWxlMi5JcFByb3RvY29sOyB9XG4gIGlmIChvcC5jb3B5RnJvbVBvcnQpIHsgbW9kaWZpZWQuRnJvbVBvcnQgPSBvcC5ydWxlMi5Gcm9tUG9ydDsgfVxuICBpZiAob3AuY29weVRvUG9ydCkgeyBtb2RpZmllZC5Ub1BvcnQgPSBvcC5ydWxlMi5Ub1BvcnQ7IH1cbiAgaWYgKG9wLmNvcHlDaWRySXApIHsgbW9kaWZpZWQuQ2lkcklwID0gb3AucnVsZTIuQ2lkcklwOyB9XG4gIGlmIChvcC5jb3B5U2VjdXJpdHlHcm91cElkKSB7IG1vZGlmaWVkLkRlc3RpbmF0aW9uU2VjdXJpdHlHcm91cElkID0gb3AucnVsZTIuRGVzdGluYXRpb25TZWN1cml0eUdyb3VwSWQ7IH1cbiAgaWYgKG9wLmNvcHlQcmVmaXhMaXN0SWQpIHsgbW9kaWZpZWQuRGVzdGluYXRpb25QcmVmaXhMaXN0SWQgPSBvcC5ydWxlMi5EZXN0aW5hdGlvblByZWZpeExpc3RJZDsgfVxuXG4gIHJldHVybiB7IHJ1bGUxOiBvcmlnaW5hbCwgcnVsZTI6IG1vZGlmaWVkIH07XG59KTtcbiJdfQ==