"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@aws-cdk/core");
const DEFAULT_TIMEOUT = core_1.Duration.minutes(30);
const DEFAULT_INTERVAL = core_1.Duration.seconds(5);
function calculateRetryPolicy(props = {}) {
    const totalTimeout = props.totalTimeout || DEFAULT_TIMEOUT;
    const interval = props.queryInterval || DEFAULT_INTERVAL;
    const maxAttempts = totalTimeout.toSeconds() / interval.toSeconds();
    if (Math.round(maxAttempts) !== maxAttempts) {
        throw new Error(`Cannot determine retry count since totalTimeout=${totalTimeout.toSeconds()}s is not integrally dividable by queryInterval=${interval.toSeconds()}s`);
    }
    return {
        maxAttempts,
        interval,
        backoffRate: 1,
    };
}
exports.calculateRetryPolicy = calculateRetryPolicy;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBeUM7QUFFekMsTUFBTSxlQUFlLEdBQUcsZUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM3QyxNQUFNLGdCQUFnQixHQUFHLGVBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFN0MsU0FBZ0Isb0JBQW9CLENBQUMsUUFBK0QsRUFBRztJQUNyRyxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsWUFBWSxJQUFJLGVBQWUsQ0FBQztJQUMzRCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsYUFBYSxJQUFJLGdCQUFnQixDQUFDO0lBQ3pELE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxTQUFTLEVBQUUsR0FBRyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7SUFFcEUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLFdBQVcsRUFBRTtRQUMzQyxNQUFNLElBQUksS0FBSyxDQUFDLG1EQUFtRCxZQUFZLENBQUMsU0FBUyxFQUFFLGtEQUFrRCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0tBQ3ZLO0lBRUQsT0FBTztRQUNMLFdBQVc7UUFDWCxRQUFRO1FBQ1IsV0FBVyxFQUFFLENBQUM7S0FDZixDQUFDO0FBQ0osQ0FBQztBQWRELG9EQWNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHVyYXRpb24gfSBmcm9tICdAYXdzLWNkay9jb3JlJztcblxuY29uc3QgREVGQVVMVF9USU1FT1VUID0gRHVyYXRpb24ubWludXRlcygzMCk7XG5jb25zdCBERUZBVUxUX0lOVEVSVkFMID0gRHVyYXRpb24uc2Vjb25kcyg1KTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVJldHJ5UG9saWN5KHByb3BzOiB7IHRvdGFsVGltZW91dD86IER1cmF0aW9uLCBxdWVyeUludGVydmFsPzogRHVyYXRpb24gfSA9IHsgfSkge1xuICBjb25zdCB0b3RhbFRpbWVvdXQgPSBwcm9wcy50b3RhbFRpbWVvdXQgfHwgREVGQVVMVF9USU1FT1VUO1xuICBjb25zdCBpbnRlcnZhbCA9IHByb3BzLnF1ZXJ5SW50ZXJ2YWwgfHwgREVGQVVMVF9JTlRFUlZBTDtcbiAgY29uc3QgbWF4QXR0ZW1wdHMgPSB0b3RhbFRpbWVvdXQudG9TZWNvbmRzKCkgLyBpbnRlcnZhbC50b1NlY29uZHMoKTtcblxuICBpZiAoTWF0aC5yb3VuZChtYXhBdHRlbXB0cykgIT09IG1heEF0dGVtcHRzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZGV0ZXJtaW5lIHJldHJ5IGNvdW50IHNpbmNlIHRvdGFsVGltZW91dD0ke3RvdGFsVGltZW91dC50b1NlY29uZHMoKX1zIGlzIG5vdCBpbnRlZ3JhbGx5IGRpdmlkYWJsZSBieSBxdWVyeUludGVydmFsPSR7aW50ZXJ2YWwudG9TZWNvbmRzKCl9c2ApO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBtYXhBdHRlbXB0cyxcbiAgICBpbnRlcnZhbCxcbiAgICBiYWNrb2ZmUmF0ZTogMSxcbiAgfTtcbn1cbiJdfQ==