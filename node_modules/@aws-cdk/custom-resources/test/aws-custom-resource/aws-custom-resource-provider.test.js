"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk-mock");
const fs = require("fs-extra");
const nock = require("nock");
const sinon = require("sinon");
const lib_1 = require("../../lib");
const runtime_1 = require("../../lib/aws-custom-resource/runtime");
AWS.setSDK(require.resolve('aws-sdk'));
console.log = jest.fn(); // tslint:disable-line no-console
const eventCommon = {
    ServiceToken: 'token',
    ResponseURL: 'https://localhost',
    StackId: 'stackId',
    RequestId: 'requestId',
    LogicalResourceId: 'logicalResourceId',
    ResourceType: 'Custom::AWS',
};
function createRequest(bodyPredicate) {
    return nock('https://localhost')
        .put('/', bodyPredicate)
        .reply(200);
}
beforeEach(() => {
    process.env.USE_NORMAL_SDK = 'true';
});
afterEach(() => {
    AWS.restore();
    nock.cleanAll();
    delete process.env.USE_NORMAL_SDK;
});
test('create event with physical resource id path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'second-key-etag' &&
        body.Data['Contents.0.Key'] === 'first-key');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(listObjectsFake, {
        Bucket: 'my-bucket',
    });
    expect(request.isDone()).toBeTruthy();
});
test('update event with physical resource id', async () => {
    const publish = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publish);
    const event = {
        ...eventCommon,
        RequestType: 'Update',
        PhysicalResourceId: 'physicalResourceId',
        OldResourceProperties: {},
        ResourceProperties: {
            ServiceToken: 'token',
            Update: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'hello',
                    TopicArn: 'topicarn',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('topicarn'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'topicarn');
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('delete event', async () => {
    const listObjectsFake = sinon.fake.resolves({});
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await runtime_1.handler(event, {});
    sinon.assert.notCalled(listObjectsFake);
    expect(request.isDone()).toBeTruthy();
});
test('delete event with Delete call and no physical resource id in call', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: {
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(deleteParameterFake, {
        Name: 'my-param',
    });
    expect(request.isDone()).toBeTruthy();
});
test('create event with Delete call only', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: {
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'logicalResourceId');
    await runtime_1.handler(event, {});
    sinon.assert.notCalled(deleteParameterFake);
    expect(request.isDone()).toBeTruthy();
});
test('catch errors', async () => {
    const error = new Error();
    error.code = 'NoSuchBucket';
    const listObjectsFake = sinon.fake.rejects(error);
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('physicalResourceId'),
                ignoreErrorCodesMatching: 'NoSuchBucket',
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('decodes booleans', async () => {
    const putItemFake = sinon.fake.resolves({});
    AWS.mock('DynamoDB', 'putItem', putItemFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'DynamoDB',
                action: 'putItem',
                parameters: {
                    TableName: 'table',
                    Item: {
                        True: {
                            BOOL: 'TRUE:BOOLEAN',
                        },
                        TrueString: {
                            S: 'true',
                        },
                        False: {
                            BOOL: 'FALSE:BOOLEAN',
                        },
                        FalseString: {
                            S: 'false',
                        },
                    },
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('put-item'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(putItemFake, {
        TableName: 'table',
        Item: {
            True: {
                BOOL: true,
            },
            TrueString: {
                S: 'true',
            },
            False: {
                BOOL: false,
            },
            FalseString: {
                S: 'false',
            },
        },
    });
    expect(request.isDone()).toBeTruthy();
});
test('restrict output path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
                outputPath: 'Contents.0',
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'id' &&
        body.Data['Contents.0.Key'] === 'first-key' &&
        body.Data['Contents.1.Key'] === undefined);
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('can specify apiVersion and region', async () => {
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                apiVersion: '2010-03-31',
                region: 'eu-west-1',
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.Data.apiVersion === '2010-03-31' &&
        body.Data.region === 'eu-west-1');
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('flatten correctly flattens a nested object', () => {
    expect(runtime_1.flatten({
        a: { b: 'c' },
        d: [
            { e: 'f' },
            { g: 'h', i: 1, j: null, k: { l: false } },
        ],
    })).toEqual({
        'a.b': 'c',
        'd.0.e': 'f',
        'd.1.g': 'h',
        'd.1.i': 1,
        'd.1.j': null,
        'd.1.k.l': false,
    });
});
test('installs the latest SDK', async () => {
    const tmpPath = '/tmp/node_modules/aws-sdk';
    fs.remove(tmpPath);
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS');
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
    expect(() => require.resolve(tmpPath)).not.toThrow();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esb0NBQW9DO0FBQ3BDLCtCQUErQjtBQUMvQiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLG1DQUEyRDtBQUMzRCxtRUFBeUU7QUFFekUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFFdkMsT0FBTyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxpQ0FBaUM7QUFFMUQsTUFBTSxXQUFXLEdBQUc7SUFDbEIsWUFBWSxFQUFFLE9BQU87SUFDckIsV0FBVyxFQUFFLG1CQUFtQjtJQUNoQyxPQUFPLEVBQUUsU0FBUztJQUNsQixTQUFTLEVBQUUsV0FBVztJQUN0QixpQkFBaUIsRUFBRSxtQkFBbUI7SUFDdEMsWUFBWSxFQUFFLGFBQWE7Q0FDNUIsQ0FBQztBQUVGLFNBQVMsYUFBYSxDQUFDLGFBQWdGO0lBQ3JHLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDO1NBQzdCLEdBQUcsQ0FBQyxHQUFHLEVBQUUsYUFBYSxDQUFDO1NBQ3ZCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNoQixDQUFDO0FBRUQsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQztBQUN0QyxDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxHQUFHLEVBQUU7SUFDYixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDZCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDaEIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztBQUNwQyxDQUFDLENBQUMsQ0FBQztBQUVI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QU8sRUFBRSxDQUFDO0FBQ3ZELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgU0RLIGZyb20gJ2F3cy1zZGsnO1xuaW1wb3J0ICogYXMgQVdTIGZyb20gJ2F3cy1zZGstbW9jayc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBub2NrIGZyb20gJ25vY2snO1xuaW1wb3J0ICogYXMgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgQXdzU2RrQ2FsbCwgUGh5c2ljYWxSZXNvdXJjZUlkIH0gZnJvbSAnLi4vLi4vbGliJztcbmltcG9ydCB7IGZsYXR0ZW4sIGhhbmRsZXIgfSBmcm9tICcuLi8uLi9saWIvYXdzLWN1c3RvbS1yZXNvdXJjZS9ydW50aW1lJztcblxuQVdTLnNldFNESyhyZXF1aXJlLnJlc29sdmUoJ2F3cy1zZGsnKSk7XG5cbmNvbnNvbGUubG9nID0gamVzdC5mbigpOyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcblxuY29uc3QgZXZlbnRDb21tb24gPSB7XG4gIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgUmVzcG9uc2VVUkw6ICdodHRwczovL2xvY2FsaG9zdCcsXG4gIFN0YWNrSWQ6ICdzdGFja0lkJyxcbiAgUmVxdWVzdElkOiAncmVxdWVzdElkJyxcbiAgTG9naWNhbFJlc291cmNlSWQ6ICdsb2dpY2FsUmVzb3VyY2VJZCcsXG4gIFJlc291cmNlVHlwZTogJ0N1c3RvbTo6QVdTJyxcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlcXVlc3QoYm9keVByZWRpY2F0ZTogKGJvZHk6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlUmVzcG9uc2UpID0+IGJvb2xlYW4pIHtcbiAgcmV0dXJuIG5vY2soJ2h0dHBzOi8vbG9jYWxob3N0JylcbiAgICAucHV0KCcvJywgYm9keVByZWRpY2F0ZSlcbiAgICAucmVwbHkoMjAwKTtcbn1cblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIHByb2Nlc3MuZW52LlVTRV9OT1JNQUxfU0RLID0gJ3RydWUnO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIEFXUy5yZXN0b3JlKCk7XG4gIG5vY2suY2xlYW5BbGwoKTtcbiAgZGVsZXRlIHByb2Nlc3MuZW52LlVTRV9OT1JNQUxfU0RLO1xufSk7XG5cbnRlc3QoJ2NyZWF0ZSBldmVudCB3aXRoIHBoeXNpY2FsIHJlc291cmNlIGlkIHBhdGgnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxpc3RPYmplY3RzRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe1xuICAgIENvbnRlbnRzOiBbXG4gICAgICB7XG4gICAgICAgIEtleTogJ2ZpcnN0LWtleScsXG4gICAgICAgIEVUYWc6ICdmaXJzdC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBLZXk6ICdzZWNvbmQta2V5JyxcbiAgICAgICAgRVRhZzogJ3NlY29uZC1rZXktZXRhZycsXG4gICAgICB9LFxuICAgIF0sXG4gIH0gYXMgU0RLLlMzLkxpc3RPYmplY3RzT3V0cHV0KTtcblxuICBBV1MubW9jaygnUzMnLCAnbGlzdE9iamVjdHMnLCBsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5mcm9tUmVzcG9uc2UoJ0NvbnRlbnRzLjEuRVRhZycpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3NlY29uZC1rZXktZXRhZycgJiZcbiAgICBib2R5LkRhdGEhWydDb250ZW50cy4wLktleSddID09PSAnZmlyc3Qta2V5JyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgobGlzdE9iamVjdHNGYWtlLCB7XG4gICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgfSk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCd1cGRhdGUgZXZlbnQgd2l0aCBwaHlzaWNhbCByZXNvdXJjZSBpZCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgcHVibGlzaCA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTTlMnLCAncHVibGlzaCcsIHB1Ymxpc2gpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZVVwZGF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnVXBkYXRlJyxcbiAgICBQaHlzaWNhbFJlc291cmNlSWQ6ICdwaHlzaWNhbFJlc291cmNlSWQnLFxuICAgIE9sZFJlc291cmNlUHJvcGVydGllczoge30sXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBVcGRhdGU6IHtcbiAgICAgICAgc2VydmljZTogJ1NOUycsXG4gICAgICAgIGFjdGlvbjogJ3B1Ymxpc2gnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTWVzc2FnZTogJ2hlbGxvJyxcbiAgICAgICAgICBUb3BpY0FybjogJ3RvcGljYXJuJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ3RvcGljYXJuJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAndG9waWNhcm4nLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2RlbGV0ZSBldmVudCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgbGlzdE9iamVjdHNGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7fSk7XG5cbiAgQVdTLm1vY2soJ1MzJywgJ2xpc3RPYmplY3RzJywgbGlzdE9iamVjdHNGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VEZWxldGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0RlbGV0ZScsXG4gICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAncGh5c2ljYWxSZXNvdXJjZUlkJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5mcm9tUmVzcG9uc2UoJ0NvbnRlbnRzLjEuRVRhZycpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3BoeXNpY2FsUmVzb3VyY2VJZCcgJiZcbiAgICBPYmplY3Qua2V5cyhib2R5LkRhdGEhKS5sZW5ndGggPT09IDAsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIHNpbm9uLmFzc2VydC5ub3RDYWxsZWQobGlzdE9iamVjdHNGYWtlKTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2RlbGV0ZSBldmVudCB3aXRoIERlbGV0ZSBjYWxsIGFuZCBubyBwaHlzaWNhbCByZXNvdXJjZSBpZCBpbiBjYWxsJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBkZWxldGVQYXJhbWV0ZXJGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7fSk7XG5cbiAgQVdTLm1vY2soJ1NTTScsICdkZWxldGVQYXJhbWV0ZXInLCBkZWxldGVQYXJhbWV0ZXJGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VEZWxldGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0RlbGV0ZScsXG4gICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAncGh5c2ljYWxSZXNvdXJjZUlkJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIERlbGV0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnU1NNJyxcbiAgICAgICAgYWN0aW9uOiAnZGVsZXRlUGFyYW1ldGVyJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIE5hbWU6ICdteS1wYXJhbScsXG4gICAgICAgIH0sXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAncGh5c2ljYWxSZXNvdXJjZUlkJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgc2lub24uYXNzZXJ0LmNhbGxlZFdpdGgoZGVsZXRlUGFyYW1ldGVyRmFrZSwge1xuICAgIE5hbWU6ICdteS1wYXJhbScsXG4gIH0pO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY3JlYXRlIGV2ZW50IHdpdGggRGVsZXRlIGNhbGwgb25seScsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgZGVsZXRlUGFyYW1ldGVyRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTU00nLCAnZGVsZXRlUGFyYW1ldGVyJywgZGVsZXRlUGFyYW1ldGVyRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgRGVsZXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdTU00nLFxuICAgICAgICBhY3Rpb246ICdkZWxldGVQYXJhbWV0ZXInLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTmFtZTogJ215LXBhcmFtJyxcbiAgICAgICAgfSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdsb2dpY2FsUmVzb3VyY2VJZCcsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIHNpbm9uLmFzc2VydC5ub3RDYWxsZWQoZGVsZXRlUGFyYW1ldGVyRmFrZSk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdjYXRjaCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGVycm9yOiBOb2RlSlMuRXJybm9FeGNlcHRpb24gPSBuZXcgRXJyb3IoKTtcbiAgZXJyb3IuY29kZSA9ICdOb1N1Y2hCdWNrZXQnO1xuICBjb25zdCBsaXN0T2JqZWN0c0Zha2UgPSBzaW5vbi5mYWtlLnJlamVjdHMoZXJyb3IpO1xuXG4gIEFXUy5tb2NrKCdTMycsICdsaXN0T2JqZWN0cycsIGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdTMycsXG4gICAgICAgIGFjdGlvbjogJ2xpc3RPYmplY3RzJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIEJ1Y2tldDogJ215LWJ1Y2tldCcsXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdwaHlzaWNhbFJlc291cmNlSWQnKSxcbiAgICAgICAgaWdub3JlRXJyb3JDb2Rlc01hdGNoaW5nOiAnTm9TdWNoQnVja2V0JyxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdwaHlzaWNhbFJlc291cmNlSWQnICYmXG4gICAgT2JqZWN0LmtleXMoYm9keS5EYXRhISkubGVuZ3RoID09PSAwLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2RlY29kZXMgYm9vbGVhbnMnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1dEl0ZW1GYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7fSk7XG5cbiAgQVdTLm1vY2soJ0R5bmFtb0RCJywgJ3B1dEl0ZW0nLCBwdXRJdGVtRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdEeW5hbW9EQicsXG4gICAgICAgIGFjdGlvbjogJ3B1dEl0ZW0nLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgVGFibGVOYW1lOiAndGFibGUnLFxuICAgICAgICAgIEl0ZW06IHtcbiAgICAgICAgICAgIFRydWU6IHtcbiAgICAgICAgICAgICAgQk9PTDogJ1RSVUU6Qk9PTEVBTicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgVHJ1ZVN0cmluZzoge1xuICAgICAgICAgICAgICBTOiAndHJ1ZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgRmFsc2U6IHtcbiAgICAgICAgICAgICAgQk9PTDogJ0ZBTFNFOkJPT0xFQU4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEZhbHNlU3RyaW5nOiB7XG4gICAgICAgICAgICAgIFM6ICdmYWxzZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdwdXQtaXRlbScpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKHB1dEl0ZW1GYWtlLCB7XG4gICAgVGFibGVOYW1lOiAndGFibGUnLFxuICAgIEl0ZW06IHtcbiAgICAgIFRydWU6IHtcbiAgICAgICAgQk9PTDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBUcnVlU3RyaW5nOiB7XG4gICAgICAgIFM6ICd0cnVlJyxcbiAgICAgIH0sXG4gICAgICBGYWxzZToge1xuICAgICAgICBCT09MOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBGYWxzZVN0cmluZzoge1xuICAgICAgICBTOiAnZmFsc2UnLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ3Jlc3RyaWN0IG91dHB1dCBwYXRoJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBsaXN0T2JqZWN0c0Zha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHtcbiAgICBDb250ZW50czogW1xuICAgICAge1xuICAgICAgICBLZXk6ICdmaXJzdC1rZXknLFxuICAgICAgICBFVGFnOiAnZmlyc3Qta2V5LWV0YWcnLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgS2V5OiAnc2Vjb25kLWtleScsXG4gICAgICAgIEVUYWc6ICdzZWNvbmQta2V5LWV0YWcnLFxuICAgICAgfSxcbiAgICBdLFxuICB9IGFzIFNESy5TMy5MaXN0T2JqZWN0c091dHB1dCk7XG5cbiAgQVdTLm1vY2soJ1MzJywgJ2xpc3RPYmplY3RzJywgbGlzdE9iamVjdHNGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IHtcbiAgICAgICAgc2VydmljZTogJ1MzJyxcbiAgICAgICAgYWN0aW9uOiAnbGlzdE9iamVjdHMnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ2lkJyksXG4gICAgICAgIG91dHB1dFBhdGg6ICdDb250ZW50cy4wJyxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdpZCcgJiZcbiAgICBib2R5LkRhdGEhWydDb250ZW50cy4wLktleSddID09PSAnZmlyc3Qta2V5JyAmJlxuICAgIGJvZHkuRGF0YSFbJ0NvbnRlbnRzLjEuS2V5J10gPT09IHVuZGVmaW5lZCxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdjYW4gc3BlY2lmeSBhcGlWZXJzaW9uIGFuZCByZWdpb24nLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1Ymxpc2hGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7fSk7XG5cbiAgQVdTLm1vY2soJ1NOUycsICdwdWJsaXNoJywgcHVibGlzaEZha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnU05TJyxcbiAgICAgICAgYWN0aW9uOiAncHVibGlzaCcsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBNZXNzYWdlOiAnbWVzc2FnZScsXG4gICAgICAgICAgVG9waWNBcm46ICd0b3BpYycsXG4gICAgICAgIH0sXG4gICAgICAgIGFwaVZlcnNpb246ICcyMDEwLTAzLTMxJyxcbiAgICAgICAgcmVnaW9uOiAnZXUtd2VzdC0xJyxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ2lkJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuRGF0YSEuYXBpVmVyc2lvbiA9PT0gJzIwMTAtMDMtMzEnICYmXG4gICAgYm9keS5EYXRhIS5yZWdpb24gPT09ICdldS13ZXN0LTEnLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2ZsYXR0ZW4gY29ycmVjdGx5IGZsYXR0ZW5zIGEgbmVzdGVkIG9iamVjdCcsICgpID0+IHtcbiAgZXhwZWN0KGZsYXR0ZW4oe1xuICAgIGE6IHsgYjogJ2MnIH0sXG4gICAgZDogW1xuICAgICAgeyBlOiAnZicgfSxcbiAgICAgIHsgZzogJ2gnLCBpOiAxLCBqOiBudWxsLCBrOiB7IGw6IGZhbHNlIH0gfSxcbiAgICBdLFxuICB9KSkudG9FcXVhbCh7XG4gICAgJ2EuYic6ICdjJyxcbiAgICAnZC4wLmUnOiAnZicsXG4gICAgJ2QuMS5nJzogJ2gnLFxuICAgICdkLjEuaSc6IDEsXG4gICAgJ2QuMS5qJzogbnVsbCxcbiAgICAnZC4xLmsubCc6IGZhbHNlLFxuICB9KTtcbn0pO1xuXG50ZXN0KCdpbnN0YWxscyB0aGUgbGF0ZXN0IFNESycsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgdG1wUGF0aCA9ICcvdG1wL25vZGVfbW9kdWxlcy9hd3Mtc2RrJztcblxuICBmcy5yZW1vdmUodG1wUGF0aCk7XG5cbiAgY29uc3QgcHVibGlzaEZha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHt9KTtcblxuICBBV1MubW9jaygnU05TJywgJ3B1Ymxpc2gnLCBwdWJsaXNoRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdTTlMnLFxuICAgICAgICBhY3Rpb246ICdwdWJsaXNoJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIE1lc3NhZ2U6ICdtZXNzYWdlJyxcbiAgICAgICAgICBUb3BpY0FybjogJ3RvcGljJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQub2YoJ2lkJyksXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcblxuICBleHBlY3QoKCkgPT4gcmVxdWlyZS5yZXNvbHZlKHRtcFBhdGgpKS5ub3QudG9UaHJvdygpO1xufSk7XG4iXX0=